<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>9&nbsp; Numerical Optimization 2 – Notes for 3611: Programming in Quantitative Economics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./constrainedandpitfalls.html" rel="next">
<link href="./numericaloptimization1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ecba78ac1d23ec93bb40517a5fbc1f6e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lectures.html">Lectures</a></li><li class="breadcrumb-item"><a href="./numericaloptimization2.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Numerical Optimization 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Notes for 3611: Programming in Quantitative Economics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./lectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to the Course</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started_with_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basic_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Basic Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programming_w_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programming with Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./efficiency_and_parallel_computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Program Efficiency and Parallel Computing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction_to_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rootfinding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Root-finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numericaloptimization1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Numerical Optimization 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numericaloptimization2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Numerical Optimization 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./constrainedandpitfalls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Constrained Optimization and Pitfalls in Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cpp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Integration of C++ Code with Rcpp</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Creating R packages with RStudio</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./problemsets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem sets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exercise set 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Exercise set 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Exercise set 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Exercise set 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Exercise set 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Exercise set 6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2020.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Ordinary exam 2020</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2021.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ordinary exam 2021</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2021re.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Retake exam 2021</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2022.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Ordinary exam 2022</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2022re.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Retake exam 2022</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2023.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Ordinary exam 2023</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2023re.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Retake exam 2023</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2024.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Ordinary exam 2024</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2024retake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Retake exam 2024</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extra_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Extra exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./advanced_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Advanced exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extra_extra_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Extra extra exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./likelihood_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Likelihood Exercises</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#multivariate-optimization" id="toc-multivariate-optimization" class="nav-link active" data-scroll-target="#multivariate-optimization"><span class="header-section-number">9.1</span> Multivariate Optimization</a></li>
  <li>
<a href="#steepest-ascent-method" id="toc-steepest-ascent-method" class="nav-link" data-scroll-target="#steepest-ascent-method"><span class="header-section-number">9.2</span> Steepest ascent method</a>
  <ul class="collapse">
<li><a href="#steepest-ascent-method-implementation-in-r" id="toc-steepest-ascent-method-implementation-in-r" class="nav-link" data-scroll-target="#steepest-ascent-method-implementation-in-r"><span class="header-section-number">9.2.1</span> Steepest ascent method: Implementation in R</a></li>
  <li><a href="#line-search" id="toc-line-search" class="nav-link" data-scroll-target="#line-search"><span class="header-section-number">9.2.2</span> Line search</a></li>
  <li><a href="#line-search-implementation-in-r" id="toc-line-search-implementation-in-r" class="nav-link" data-scroll-target="#line-search-implementation-in-r"><span class="header-section-number">9.2.3</span> Line-search: Implementation in R</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">9.2.4</span> Example</a></li>
  </ul>
</li>
  <li>
<a href="#newtons-method-in-higher-dimensions" id="toc-newtons-method-in-higher-dimensions" class="nav-link" data-scroll-target="#newtons-method-in-higher-dimensions"><span class="header-section-number">9.3</span> Newton’s method in higher dimensions</a>
  <ul class="collapse">
<li><a href="#newtons-method-implementation-in-r" id="toc-newtons-method-implementation-in-r" class="nav-link" data-scroll-target="#newtons-method-implementation-in-r"><span class="header-section-number">9.3.1</span> Newton’s method: Implementation in R</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1"><span class="header-section-number">9.3.2</span> Example</a></li>
  </ul>
</li>
  <li><a href="#disadvantages-of-steepest-ascent-and-newtons-method" id="toc-disadvantages-of-steepest-ascent-and-newtons-method" class="nav-link" data-scroll-target="#disadvantages-of-steepest-ascent-and-newtons-method"><span class="header-section-number">9.4</span> Disadvantages of steepest ascent and Newton’s method</a></li>
  <li><a href="#gradient-and-hessian-in-r" id="toc-gradient-and-hessian-in-r" class="nav-link" data-scroll-target="#gradient-and-hessian-in-r"><span class="header-section-number">9.5</span> Gradient and Hessian in R</a></li>
  <li>
<a href="#optimization-in-r-multivariate" id="toc-optimization-in-r-multivariate" class="nav-link" data-scroll-target="#optimization-in-r-multivariate"><span class="header-section-number">9.6</span> Optimization in R: multivariate</a>
  <ul class="collapse">
<li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2"><span class="header-section-number">9.6.1</span> Example</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lectures.html">Lectures</a></li><li class="breadcrumb-item"><a href="./numericaloptimization2.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Numerical Optimization 2</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Numerical Optimization 2</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="multivariate-optimization" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="multivariate-optimization">
<span class="header-section-number">9.1</span> Multivariate Optimization</h2>
<p>We now turn to the more useful but more difficult problem of finding local minima or maxima of a function of several variables, i.e., <strong>multivariate optimization</strong>.</p>
<p>Let <span class="math inline">\(f : \mathbb{R}^d \rightarrow \mathbb{R}\)</span> and suppose that all of the first- and second-order partial derivatives of <span class="math inline">\(f\)</span> exist and are continuous everywhere.</p>
<p>Denote the <em>i</em>-th partial derivative at <span class="math inline">\(\mathbf{x}=(x_1,...,x_d)^\intercal\)</span> as <span class="math inline">\(f_i(\mathbf{x})=\frac{\partial f(\mathbf{x})}{\partial x_i}\)</span> and define the <em>gradient</em>:</p>
<p><span class="math display">\[
\nabla f(\mathbf{x}) = (f_1(\mathbf{x}), f_2(\mathbf{x}), \dots, f_d(\mathbf{x}))^{\top},
\]</span></p>
<p>And the <em>Hessian</em>:</p>
<p><span class="math display">\[
\mathbf{H}(\mathbf{x}) =
\begin{pmatrix}
\frac{\partial^2 f(\mathbf{x})}{\partial x_1 \partial x_1} &amp; \cdots &amp; \frac{\partial^2 f(\mathbf{x})}{\partial x_1 \partial x_d} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial^2 f(\mathbf{x})}{\partial x_d \partial x_1} &amp; \cdots &amp; \frac{\partial^2 f(\mathbf{x})}{\partial x_d \partial x_d}
\end{pmatrix}
\]</span></p>
<p>A necessary (but not sufficient) condition for a local maximum at <span class="math inline">\(\mathbf{x}\)</span> is <span class="math inline">\(\nabla f(\mathbf{x})=\mathbf{0}\)</span> and the Hessian is <strong>negative semi-definite</strong>.</p>
<p>A sufficient (but not necessary) condition for a local maximum at <span class="math inline">\(\mathbf{x}\)</span> is <span class="math inline">\(\nabla f(\mathbf{x})=\mathbf{0}\)</span> and the Hessian is <strong>negative definite</strong>.</p>
<p>As in one dimension, we will use iterative local search techniques to find local maxima.</p>
<p>Define <span class="math inline">\(||\mathbf{x}||_\infty = \max_i{|x_i|}\)</span>, In higher dimensions, we use stopping conditions that are combinations of the following:</p>
<ul>
<li><p><span class="math inline">\(\|\mathbf{x}_n - \mathbf{x}_{n-1}\|_{\infty} \leq \varepsilon;\)</span></p></li>
<li><p><span class="math inline">\(|f(\mathbf{x}_n) - f(\mathbf{x}_{n-1})| \leq \varepsilon;\)</span></p></li>
<li><p><span class="math inline">\(\|\nabla f(\mathbf{x}_n)\|_{\infty} \leq \varepsilon;\)</span></p></li>
<li><p>And to guard against non-convergence, we also specify a maximum number of iterations <span class="math inline">\(n_{max}\)</span>, then stop when <span class="math inline">\(n=n_{max}\)</span>.</p></li>
</ul></section><section id="steepest-ascent-method" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="steepest-ascent-method">
<span class="header-section-number">9.2</span> Steepest ascent method</h2>
<p>Let <span class="math inline">\(f : \mathbb{R}^d \rightarrow \mathbb{R}\)</span> be a function with continuous partial derivatives everywhere. We wish to find a local maximum of <span class="math inline">\(f\)</span> in the neighborhood of some point <span class="math inline">\(x_0\)</span>.</p>
<p>In the steepest ascent method, we seek a local maximum by moving in the direction of the gradient, which is the direction with the largest slope, i.e., the steepest ascent. (The direction with the smallest slope at the point <span class="math inline">\(\mathbf{x}\)</span> is <span class="math inline">\(- \nabla f(\mathbf{x})\)</span>, which you use if you are searching for a local minimum).</p>
<p>Thus, the steepest ascent method has the form:</p>
<p><span class="math display">\[
\mathbf{x}_{n+1} = \mathbf{x}_n + \alpha \nabla f(\mathbf{x}_n)
\]</span></p>
<p>With some <span class="math inline">\(\alpha \ge 0\)</span> being the step size while <span class="math inline">\(\nabla f(\mathbf{x}_n)\)</span> is the direction of the step.</p>
<p>Given this form, we choose <span class="math inline">\(\alpha \ge 0\)</span> to maximize.</p>
<p><span class="math display">\[
g(\alpha) = f(\mathbf{x}_n + \alpha \nabla f(\mathbf{x}_n)) = f(\mathbf{x}_{n+1}).
\]</span></p>
<p>Unless we’re already at a local maximum, we will always choose <span class="math inline">\(\alpha &gt; 0\)</span> with <span class="math inline">\(f(\mathbf{x}_{n+1}) &gt; f(\mathbf{x}_n)\)</span>.</p>
<p>If <span class="math inline">\(f\)</span> is bounded from above then, because <span class="math inline">\(f(\mathbf{x}_{n+1}) \ge f(\mathbf{x}_n)\)</span>, the sequence <span class="math inline">\(\{f(\mathbf{x}_n)\}_{n=1}^{\infty}\)</span> must converge, which suggests that we can use the stopping condition <span class="math inline">\(f(\mathbf{x}_{n+1}) - f(\mathbf{x}_n) \le \varepsilon\)</span> for some small tolerance <span class="math inline">\(\varepsilon &gt; 0\)</span>.</p>
<p>Define the function <code>line.search</code> that takes arguments <span class="math inline">\(f\)</span>, <span class="math inline">\(\mathbf{x}_n\)</span>, and <span class="math inline">\(\nabla f(\mathbf{x}_n)\)</span> and returns <span class="math inline">\(\mathbf{x}_n + \alpha^* \nabla f(\mathbf{x}_n)\)</span>, where <span class="math inline">\(\alpha^*\)</span> is the value that maximizes <span class="math inline">\(g(\alpha)\)</span>), we can sketch the implementation of the steepest ascent method.</p>
<section id="steepest-ascent-method-implementation-in-r" class="level3" data-number="9.2.1"><h3 data-number="9.2.1" class="anchored" data-anchor-id="steepest-ascent-method-implementation-in-r">
<span class="header-section-number">9.2.1</span> Steepest ascent method: Implementation in R</h3>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ascent</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">grad.f</span>, <span class="va">vX0</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">n.max</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vX.old</span> <span class="op">&lt;-</span> <span class="va">vX0</span></span>
<span>  <span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu">line.search</span><span class="op">(</span><span class="va">f</span>, <span class="va">vX0</span>, <span class="fu">grad.f</span><span class="op">(</span><span class="va">vX0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">-</span> <span class="fu">f</span><span class="op">(</span><span class="va">vX.old</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="va">n.max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vX.old</span> <span class="op">&lt;-</span> <span class="va">vX</span></span>
<span>    <span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu">line.search</span><span class="op">(</span><span class="va">f</span>, <span class="va">vX</span>, <span class="fu">grad.f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"at iteration"</span>, <span class="va">n</span>, <span class="st">"the coordinates of x are"</span>, <span class="va">vX</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="line-search" class="level3" data-number="9.2.2"><h3 data-number="9.2.2" class="anchored" data-anchor-id="line-search">
<span class="header-section-number">9.2.2</span> Line search</h3>
<p>To complete the steepest ascent algorithm, at each step <span class="math inline">\(n\)</span>, given the optimal direction <span class="math inline">\(\mathbf{\nabla} f(\mathbf{x}_n)\)</span>, we need to find the optimal step size, <span class="math inline">\(\alpha^*\)</span>, that is, we need to maximize <span class="math inline">\(g(\alpha) = f(\mathbf{x}_n + \alpha \mathbf{\nabla} f(\mathbf{x}_n))\)</span> over <span class="math inline">\(\alpha &gt; 0\)</span>.</p>
<p>Hence, we need to find</p>
<p><span class="math display">\[\alpha^* = \underset{\alpha}{\operatorname{arg max}} f(\mathbf{x}_n + \alpha \mathbf{\nabla} f(\mathbf{x}_n)).\]</span></p>
<p>As we know, it is very hard to find a global maximum, so we will instead look for a local maximum, for which we will use the golden-section algorithm.</p>
<p>The golden-section method requires three initial points <span class="math inline">\(\alpha_l &lt; \alpha_m &lt; \alpha_r\)</span> such that <span class="math inline">\(g(\alpha_m) \ge g(\alpha_l)\)</span> and <span class="math inline">\(g(\alpha_m) \ge g(\alpha_r)\)</span>.</p>
<p>Put <span class="math inline">\(\alpha_l = 0\)</span>. Theoretically, if <span class="math inline">\(||\nabla f(\mathbf{x}_n)|| &gt; 0\)</span> then <span class="math inline">\(g'(0) &gt; 0\)</span> and there must exist some <span class="math inline">\(\varepsilon &gt; 0\)</span> such that <span class="math inline">\(g(\varepsilon) &gt; g(0)\)</span>, so we can put <span class="math inline">\(\alpha_m = \varepsilon\)</span>.</p>
<p>In practice, however, if <span class="math inline">\(g'(0)\)</span> is very small, it might not be possible to numerically distinguish <span class="math inline">\(g(0)\)</span> from <span class="math inline">\(g(\varepsilon)\)</span>, and in that case we set <span class="math inline">\(\alpha^* = 0\)</span>.</p>
<p>There is no theoretical guarantee that a suitable <span class="math inline">\(\alpha_r\)</span> exists, because we might have <span class="math inline">\(g\)</span> increasing over the whole interval <span class="math inline">\([0, \infty)\)</span>. To deal with this problem, we specify a maximum step size, <span class="math inline">\(\alpha_{max}\)</span>, such that if we cannot find <span class="math inline">\(\alpha_r \le \alpha_{max}\)</span> such that <span class="math inline">\(g(\alpha_m) \ge g(\alpha_r)\)</span>, we set <span class="math inline">\(\alpha^* = \alpha_{max}\)</span>.</p>
</section><section id="line-search-implementation-in-r" class="level3" data-number="9.2.3"><h3 data-number="9.2.3" class="anchored" data-anchor-id="line-search-implementation-in-r">
<span class="header-section-number">9.2.3</span> Line-search: Implementation in R</h3>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">line.search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">vX</span>, <span class="va">vG</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">dA.max</span> <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># f is a real function that takes a vector of length d</span></span>
<span>  <span class="co"># x and y are vectors of length d</span></span>
<span>  <span class="co"># line.search uses gsection to find a &gt;= 0 such that</span></span>
<span>  <span class="co"># g(a) = f(x + a*y) has a local maximum at a,</span></span>
<span>  <span class="co"># within a tolerance of tol</span></span>
<span>  <span class="co"># if no local max is found then we use 0 or a.max for a</span></span>
<span>  <span class="co"># the value returned is x + a*y</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">vG</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="co"># +0*vG</span></span>
<span>  <span class="op">}</span> <span class="co"># g(a) constant</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dA</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">vX</span> <span class="op">+</span> <span class="va">dA</span><span class="op">*</span><span class="va">vG</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># find a triple a.l &lt; a.m &lt; a.r such that</span></span>
<span>  <span class="co"># g(a.l) &lt;= g(a.m) and g(a.m) &gt;= g(a.r)</span></span>
<span>  </span>
<span>  <span class="co"># choose a.l</span></span>
<span>  <span class="va">dA.l</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">g.l</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.l</span><span class="op">)</span></span>
<span>  <span class="co"># find a.m</span></span>
<span>  <span class="va">dA.m</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">g.m</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.m</span><span class="op">)</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.l</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">dA.m</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dA.m</span> <span class="op">&lt;-</span> <span class="va">dA.m</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="va">g.m</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.m</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># if a suitable a.m was not found then use 0 for a, so just return vX as the next step</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">dA.m</span> <span class="op">&lt;=</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.l</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span>  <span class="co"># find a.r</span></span>
<span>  <span class="va">dA.r</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">dA.m</span></span>
<span>  <span class="va">g.r</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.r</span><span class="op">)</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.r</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">dA.r</span> <span class="op">&lt;</span> <span class="va">dA.max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dA.m</span> <span class="op">&lt;-</span> <span class="va">dA.r</span></span>
<span>    <span class="va">g.m</span> <span class="op">&lt;-</span> <span class="va">g.r</span></span>
<span>    <span class="va">dA.r</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">dA.m</span></span>
<span>    <span class="va">g.r</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.r</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># if a suitable a.r was not found then use a.max for a</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">dA.r</span> <span class="op">&gt;=</span> <span class="va">dA.max</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.r</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span> <span class="op">+</span> <span class="va">dA.max</span><span class="op">*</span><span class="va">vG</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span>  <span class="co"># apply golden-section algorithm to g to find a</span></span>
<span>  <span class="va">dA</span> <span class="op">&lt;-</span> <span class="fu">gsection</span><span class="op">(</span><span class="va">g</span>, <span class="va">dA.l</span>, <span class="va">dA.r</span>, <span class="va">dA.m</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span> <span class="op">+</span> <span class="va">dA</span><span class="op">*</span><span class="va">vG</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note: the code depends on the golden section algorithm. Click here to view it.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># golden section algorithm from last week</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>gsection <span class="ot">&lt;-</span> <span class="cf">function</span>(f, dX.l, dX.r, dX.m, <span class="at">dTol =</span> <span class="fl">1e-9</span>) {</span>
<span id="cb3-3"><a href="#cb3-3"></a>  </span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="co"># golden ratio plus one</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  dGR1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">5</span>))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  </span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="co"># successively refine x.l, x.r, and x.m</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  f.l <span class="ot">&lt;-</span> <span class="fu">f</span>(dX.l)</span>
<span id="cb3-9"><a href="#cb3-9"></a>  f.r <span class="ot">&lt;-</span> <span class="fu">f</span>(dX.r)</span>
<span id="cb3-10"><a href="#cb3-10"></a>  f.m <span class="ot">&lt;-</span> <span class="fu">f</span>(dX.m)</span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="cf">while</span> ((dX.r <span class="sc">-</span> dX.l) <span class="sc">&gt;</span> dTol) { </span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="cf">if</span> ((dX.r <span class="sc">-</span> dX.m) <span class="sc">&gt;</span> (dX.m <span class="sc">-</span> dX.l)) { <span class="co"># if the right segment is wider than the left </span></span>
<span id="cb3-13"><a href="#cb3-13"></a>      dY <span class="ot">&lt;-</span> dX.m <span class="sc">+</span> (dX.r <span class="sc">-</span> dX.m)<span class="sc">/</span>dGR1 <span class="co"># put Y into the right segment according to the golden ratio</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>      f.y <span class="ot">&lt;-</span> <span class="fu">f</span>(dY)</span>
<span id="cb3-15"><a href="#cb3-15"></a>      <span class="cf">if</span> (f.y <span class="sc">&gt;=</span> f.m) {</span>
<span id="cb3-16"><a href="#cb3-16"></a>        dX.l <span class="ot">&lt;-</span> dX.m</span>
<span id="cb3-17"><a href="#cb3-17"></a>        f.l <span class="ot">&lt;-</span> f.m</span>
<span id="cb3-18"><a href="#cb3-18"></a>        dX.m <span class="ot">&lt;-</span> dY</span>
<span id="cb3-19"><a href="#cb3-19"></a>        f.m <span class="ot">&lt;-</span> f.y</span>
<span id="cb3-20"><a href="#cb3-20"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-21"><a href="#cb3-21"></a>        dX.r <span class="ot">&lt;-</span> dY</span>
<span id="cb3-22"><a href="#cb3-22"></a>        f.r <span class="ot">&lt;-</span> f.y</span>
<span id="cb3-23"><a href="#cb3-23"></a>      }</span>
<span id="cb3-24"><a href="#cb3-24"></a>    } <span class="cf">else</span> { <span class="co">#if the left segment is wider than the right</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>      dY <span class="ot">&lt;-</span> dX.m <span class="sc">-</span> (dX.m <span class="sc">-</span> dX.l)<span class="sc">/</span>dGR1 <span class="co"># put Y into the left segment according to the golden ratio</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>      f.y <span class="ot">&lt;-</span> <span class="fu">f</span>(dY)</span>
<span id="cb3-27"><a href="#cb3-27"></a>      <span class="cf">if</span> (f.y <span class="sc">&gt;=</span> f.m) {</span>
<span id="cb3-28"><a href="#cb3-28"></a>        dX.r <span class="ot">&lt;-</span> dX.m</span>
<span id="cb3-29"><a href="#cb3-29"></a>        f.r <span class="ot">&lt;-</span> f.m</span>
<span id="cb3-30"><a href="#cb3-30"></a>        dX.m <span class="ot">&lt;-</span> dY</span>
<span id="cb3-31"><a href="#cb3-31"></a>        f.m <span class="ot">&lt;-</span> f.y</span>
<span id="cb3-32"><a href="#cb3-32"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-33"><a href="#cb3-33"></a>        dX.l <span class="ot">&lt;-</span> dY</span>
<span id="cb3-34"><a href="#cb3-34"></a>        f.l <span class="ot">&lt;-</span> f.y</span>
<span id="cb3-35"><a href="#cb3-35"></a>      }</span>
<span id="cb3-36"><a href="#cb3-36"></a>    }</span>
<span id="cb3-37"><a href="#cb3-37"></a>  }</span>
<span id="cb3-38"><a href="#cb3-38"></a>  <span class="fu">return</span>(dX.m)</span>
<span id="cb3-39"><a href="#cb3-39"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="example" class="level3" data-number="9.2.4"><h3 data-number="9.2.4" class="anchored" data-anchor-id="example">
<span class="header-section-number">9.2.4</span> Example</h3>
<p>Consider the function <span class="math inline">\(f(x,y)=\sin(x^2/2-y^2/4) \cos(2x-\exp(y))\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dOut</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dOut</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># gradient</span></span>
<span><span class="va">grad.f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dX_prime.1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span><span class="op">*</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dX_prime.2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">dY_prime.1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">-</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dY_prime.2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">vOut</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dX_prime.1</span> <span class="op">+</span> <span class="va">dX_prime.2</span>, <span class="va">dY_prime.1</span> <span class="op">+</span> <span class="va">dY_prime.2</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vOut</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">ascent</span><span class="op">(</span><span class="va">f</span>, <span class="va">grad.f</span>, vX0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.030674 1.401513</span></span>
<span><span class="fu">ascent</span><span class="op">(</span><span class="va">f</span>, <span class="va">grad.f</span>, vX0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3424608 1.4271493</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="numericaloptimization2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="numericaloptimization2_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A small difference in where you start can make a big difference to where you end up; we find different local maxima with the two different starting points.</p>
</section></section><section id="newtons-method-in-higher-dimensions" class="level2" data-number="9.3"><h2 data-number="9.3" class="anchored" data-anchor-id="newtons-method-in-higher-dimensions">
<span class="header-section-number">9.3</span> Newton’s method in higher dimensions</h2>
<p>The steepest ascent method uses information about the gradient, i.e, the first-order derivatives of <span class="math inline">\(f\)</span>.</p>
<p>By makign use of the Hessian, i.e., the second-order derivatives of <span class="math inline">\(f\)</span>, we can construct methods that converge in fewer steps.</p>
<p>The simplest second-order technique is Newton’s method, which can be generalized from one dimension to higher dimensions relatively easily.</p>
<p>Newton’s method looks for a point <span class="math inline">\(\mathbf{x}\)</span> such that <span class="math inline">\(\nabla f(\mathbf{x})=\mathbf{0}\)</span>.</p>
<p>The basis of the method is a second-order Taylor expansion of <span class="math inline">\(f\)</span>. For any <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span> close together we have:</p>
<p><span class="math display">\[f(\mathbf{y}) \approx f(\mathbf{x}) + (\mathbf{y}-\mathbf{x})' \nabla f(\mathbf{x}) + \frac{1}{2}(\mathbf{y}-\mathbf{x})' \mathbf{H}(\mathbf{x}) (\mathbf{y}-\mathbf{x}). \qquad (1)\]</span></p>
<p>Taking first-order partial derivatives on both sides of (1) with respect to the components of <span class="math inline">\(\mathbf{y}\)</span>, we get:</p>
<p><span class="math display">\[\nabla f(\mathbf{y}) \approx \nabla f(\mathbf{x}) + \mathbf{H}(\mathbf{x}) (\mathbf{y}-\mathbf{x}).\]</span></p>
<p>If <span class="math inline">\(\mathbf{y}\)</span> is a local maximum then <span class="math inline">\(\nabla f(\mathbf{y}) = 0\)</span> and, solving the equation above, we get <span class="math inline">\(\mathbf{y} = \mathbf{x} - \mathbf{H}(\mathbf{x})^{-1} \nabla f(\mathbf{x})\)</span>.</p>
<p>Putting <span class="math inline">\(\mathbf{x} = \mathbf{x}_n\)</span> and <span class="math inline">\(\mathbf{y} = \mathbf{x}_{n+1}\)</span>, our Newton’s step in higher dimensions becomes:</p>
<p><span class="math display">\[\mathbf{x}_{n+1} = \mathbf{x}_n - \mathbf{H}(\mathbf{x}_n)^{-1} \nabla f(\mathbf{x}_n).\]</span></p>
<p>Clearly, if <span class="math inline">\(\mathbf{H}(\mathbf{x}_n)\)</span> is singular (has no inverse), then Newton’s method does not work.</p>
<p>However, as in the one-dimensional case, even if <span class="math inline">\(\mathbf{H}(\mathbf{x}_n)\)</span> is non-singular at each step, Newton’s method may not converge.</p>
<p>But if <span class="math inline">\(f\)</span> has a local maximum at <span class="math inline">\(\mathbf{x}^*\)</span>, <span class="math inline">\(f\)</span> is ‘nicely behaved’ near <span class="math inline">\(\mathbf{x}^*\)</span>, and if our initial point <span class="math inline">\(\mathbf{x}_0\)</span> is ‘close enough’ to <span class="math inline">\(\mathbf{x}^*\)</span>, then Newton’s method will converge to <span class="math inline">\(\mathbf{x}^*\)</span> quickly.</p>
<p>In implementing Newton’s method, we assume that we have some function <code>f3</code> that takes argument <span class="math inline">\(\mathbf{x}\)</span> and returns a list containing <span class="math inline">\(f(\mathbf{x})\)</span>, <span class="math inline">\(\nabla f(\mathbf{x})\)</span> and <span class="math inline">\(H(\mathbf{x})\)</span>, and for the stopping condition we use <span class="math inline">\(||\nabla f(\mathbf{x}_n)||_{\infty} \le \varepsilon\)</span>.</p>
<p>Furthermore, we make use of the fact that for an invertible matrix <span class="math inline">\(\mathbf{A} \in \mathbb{R}^{d \times d}\)</span> and a vector <span class="math inline">\(\mathbf{b} \in \mathbb{R}^d\)</span>, <span class="math inline">\(\mathbf{A}^{-1}\mathbf{b}\)</span> is the solution to the system of equations <span class="math inline">\(\mathbf{A}\mathbf{x} = \mathbf{b}\)</span>, which can be found by the R command <code>solve(A, b)</code>.</p>
<section id="newtons-method-implementation-in-r" class="level3" data-number="9.3.1"><h3 data-number="9.3.1" class="anchored" data-anchor-id="newtons-method-implementation-in-r">
<span class="header-section-number">9.3.1</span> Newton’s method: Implementation in R</h3>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">newton</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f3</span>, <span class="va">vX0</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">n.max</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Newton's method for optimisation, starting at x0</span></span>
<span>  <span class="co"># f3 is a function that given x returns the list</span></span>
<span>  <span class="co"># {f(x), grad f(x), Hessian f(x)}, for some f</span></span>
<span>  <span class="va">vX</span> <span class="op">&lt;-</span> <span class="va">vX0</span></span>
<span>  <span class="va">f3.x</span> <span class="op">&lt;-</span> <span class="fu">f3</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">f3.x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="va">n.max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vX</span> <span class="op">&lt;-</span> <span class="va">vX</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">f3.x</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">f3.x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="co">#vX &lt;- vX - solve(f3.x[[3]])%*%f3.x[[2]]</span></span>
<span>    <span class="va">f3.x</span> <span class="op">&lt;-</span> <span class="fu">f3</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"At iteration"</span>, <span class="va">n</span>, <span class="st">"the coordinates of x are"</span>, <span class="va">vX</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="va">n.max</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">'newton failed to converge\n'</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="example-1" class="level3" data-number="9.3.2"><h3 data-number="9.3.2" class="anchored" data-anchor-id="example-1">
<span class="header-section-number">9.3.2</span> Example</h3>
<p>Consider again the function <span class="math inline">\(f(x,y)=\sin(x^2/2-y^2/4) \cos(2x-\exp(y))\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">newton</span><span class="op">(</span><span class="va">f3</span>, vX0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span> <span class="co"># maximum</span></span>
<span><span class="co">#&gt; [1] 2.030697 1.401526</span></span>
<span><span class="fu">newton</span><span class="op">(</span><span class="va">f3</span>, vX0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co"># saddle point</span></span>
<span><span class="co">#&gt; [1] -0.2902213 -0.2304799</span></span>
<span><span class="fu">newton</span><span class="op">(</span><span class="va">f3</span>, vX0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.75</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="co"># minimum</span></span>
<span><span class="co">#&gt; [1]  1.8313777 -0.6516928</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="numericaloptimization2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Remember to check whether it is in fact a maximum with the <code>eigen</code> function, e.g.,</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu">f3</span><span class="op">(</span><span class="va">n1</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># maximum</span></span>
<span><span class="co">#&gt; eigen() decomposition</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1]  -2.030712 -23.079010</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vectors</span></span>
<span><span class="co">#&gt;            [,1]       [,2]</span></span>
<span><span class="co">#&gt; [1,] -0.8429247 -0.5380316</span></span>
<span><span class="co">#&gt; [2,] -0.5380316  0.8429247</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu">f3</span><span class="op">(</span><span class="va">n2</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># saddle point</span></span>
<span><span class="co">#&gt; eigen() decomposition</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1] -0.06666478 -1.20252229</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vectors</span></span>
<span><span class="co">#&gt;           [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,] -0.456103 -0.889927</span></span>
<span><span class="co">#&gt; [2,] -0.889927  0.456103</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu">f3</span><span class="op">(</span><span class="va">n3</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># minimum</span></span>
<span><span class="co">#&gt; eigen() decomposition</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1] 7.382289 0.349442</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vectors</span></span>
<span><span class="co">#&gt;             [,1]        [,2]</span></span>
<span><span class="co">#&gt; [1,] -0.99798281 -0.06348473</span></span>
<span><span class="co">#&gt; [2,]  0.06348473 -0.99798281</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to view the function f3 and the code for the plot
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#function, gradient, and hessian in list</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>f3 <span class="ot">&lt;-</span> <span class="cf">function</span>(vX) {</span>
<span id="cb8-3"><a href="#cb8-3"></a>  dA <span class="ot">&lt;-</span> vX[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">-</span> vX[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">4</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  dB <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>vX[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">exp</span>(vX[<span class="dv">2</span>])</span>
<span id="cb8-5"><a href="#cb8-5"></a>  f <span class="ot">&lt;-</span> <span class="fu">sin</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB)</span>
<span id="cb8-6"><a href="#cb8-6"></a>  f1 <span class="ot">&lt;-</span> <span class="fu">cos</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB)<span class="sc">*</span>vX[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">sin</span>(dA)<span class="sc">*</span><span class="fu">sin</span>(dB)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>  f2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">cos</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB)<span class="sc">*</span>vX[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">sin</span>(dA)<span class="sc">*</span><span class="fu">sin</span>(dB)<span class="sc">*</span><span class="fu">exp</span>(vX[<span class="dv">2</span>])</span>
<span id="cb8-8"><a href="#cb8-8"></a>  f11 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sin</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB)<span class="sc">*</span>(<span class="dv">4</span> <span class="sc">+</span> vX[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">cos</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB) <span class="sc">-</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="fu">cos</span>(dA)<span class="sc">*</span><span class="fu">sin</span>(dB)<span class="sc">*</span><span class="dv">4</span><span class="sc">*</span>vX[<span class="dv">1</span>]</span>
<span id="cb8-10"><a href="#cb8-10"></a>  f12 <span class="ot">&lt;-</span> <span class="fu">sin</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB)<span class="sc">*</span>(vX[<span class="dv">1</span>]<span class="sc">*</span>vX[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(vX[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="fu">cos</span>(dA)<span class="sc">*</span><span class="fu">sin</span>(dB)<span class="sc">*</span>(vX[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">exp</span>(vX[<span class="dv">2</span>]) <span class="sc">+</span> vX[<span class="dv">2</span>])</span>
<span id="cb8-12"><a href="#cb8-12"></a>  f22 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sin</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB)<span class="sc">*</span>(vX[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="dv">2</span><span class="sc">*</span>vX[<span class="dv">2</span>])) <span class="sc">-</span> <span class="fu">cos</span>(dA)<span class="sc">*</span><span class="fu">cos</span>(dB)<span class="sc">/</span><span class="dv">2</span> <span class="sc">-</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span class="fu">cos</span>(dA)<span class="sc">*</span><span class="fu">sin</span>(dB)<span class="sc">*</span>vX[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">exp</span>(vX[<span class="dv">2</span>]) <span class="sc">+</span> <span class="fu">sin</span>(dA)<span class="sc">*</span><span class="fu">sin</span>(dB)<span class="sc">*</span><span class="fu">exp</span>(vX[<span class="dv">2</span>])</span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="fu">return</span>(<span class="fu">list</span>(f, <span class="fu">c</span>(f1, f2), <span class="fu">matrix</span>(<span class="fu">c</span>(f11, f12, f12, f22), <span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb8-15"><a href="#cb8-15"></a>}</span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a>n1<span class="ot">&lt;-</span><span class="fu">newton</span>(f3, <span class="at">vX0 =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="fl">1.2</span>))</span>
<span id="cb8-18"><a href="#cb8-18"></a>n2<span class="ot">&lt;-</span><span class="fu">newton</span>(f3, <span class="at">vX0 =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="fl">0.5</span>))</span>
<span id="cb8-19"><a href="#cb8-19"></a>n3<span class="ot">&lt;-</span><span class="fu">newton</span>(f3, <span class="at">vX0 =</span> <span class="fu">c</span>(<span class="fl">1.75</span>, <span class="fl">0.25</span>))</span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a>{</span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">plot</span>(<span class="cn">NA</span>,<span class="at">xlim=</span><span class="fu">range</span>(vx),</span>
<span id="cb8-23"><a href="#cb8-23"></a>       <span class="at">ylim=</span><span class="fu">range</span>(vy),<span class="at">xlab=</span><span class="st">"x"</span>,<span class="at">ylab=</span><span class="st">"y"</span>,</span>
<span id="cb8-24"><a href="#cb8-24"></a>       <span class="at">frame=</span><span class="cn">FALSE</span>)</span>
<span id="cb8-25"><a href="#cb8-25"></a>  levels <span class="ot">=</span> <span class="fu">pretty</span>(<span class="fu">range</span>(mf), <span class="dv">50</span>)</span>
<span id="cb8-26"><a href="#cb8-26"></a>  color.palette <span class="ot">=</span> <span class="cf">function</span>(n) <span class="fu">hcl.colors</span>(n, <span class="st">"YlOrRd"</span>, <span class="at">rev =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="fu">.filled.contour</span>(<span class="at">x=</span>vx, <span class="at">y=</span>vy, <span class="at">z=</span>mf,</span>
<span id="cb8-28"><a href="#cb8-28"></a>                  <span class="at">levels=</span>levels,</span>
<span id="cb8-29"><a href="#cb8-29"></a>                  <span class="at">col=</span><span class="fu">color.palette</span>(<span class="fu">length</span>(levels) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="fu">points</span>(<span class="fl">1.6</span>, <span class="fl">1.2</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb8-31"><a href="#cb8-31"></a>  <span class="fu">arrows</span>(<span class="fl">1.6</span>, <span class="fl">1.2</span>, n1[<span class="dv">1</span>], n1[<span class="dv">2</span>], <span class="at">length=</span><span class="fl">0.1</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb8-32"><a href="#cb8-32"></a>  </span>
<span id="cb8-33"><a href="#cb8-33"></a>  <span class="fu">points</span>(<span class="fl">1.6</span>, <span class="fl">0.5</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">"green"</span>)</span>
<span id="cb8-34"><a href="#cb8-34"></a>  <span class="fu">arrows</span>(<span class="fl">1.6</span>, <span class="fl">0.5</span>, n2[<span class="dv">1</span>], n2[<span class="dv">2</span>], <span class="at">length=</span><span class="fl">0.1</span>, <span class="at">col=</span><span class="st">"green"</span>)</span>
<span id="cb8-35"><a href="#cb8-35"></a>  </span>
<span id="cb8-36"><a href="#cb8-36"></a>  <span class="fu">points</span>(<span class="fl">1.75</span>, <span class="fl">0.25</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb8-37"><a href="#cb8-37"></a>  <span class="fu">arrows</span>(<span class="fl">1.75</span>, <span class="fl">0.25</span>, n3[<span class="dv">1</span>], n3[<span class="dv">2</span>], <span class="at">length=</span><span class="fl">0.1</span>, <span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb8-38"><a href="#cb8-38"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The above example has illustrated that:</p>
<ul>
<li><p>Newton’s method can converge to minima or saddle points as well as maxima.</p></li>
<li><p>Newton’s method is faser than the steepest ascent method.</p></li>
<li><p>Unless you are close to a minimum or maximum, you can move in unexpected directions.</p></li>
</ul></section></section><section id="disadvantages-of-steepest-ascent-and-newtons-method" class="level2" data-number="9.4"><h2 data-number="9.4" class="anchored" data-anchor-id="disadvantages-of-steepest-ascent-and-newtons-method">
<span class="header-section-number">9.4</span> Disadvantages of steepest ascent and Newton’s method</h2>
<p>Potential disadvantages of the steepest ascent method and Newton’s method is the need to calculate the gradient and Hessian.</p>
<p>For functions that can be expressed in terms of polynomials and the simple transcendental functions (sin, cos, exp, log etc.) the process of calculating the gradient and Hessian should pose no problems (can use the R function <code>deriv</code> or just <code>D</code> to find the gradient and Hessian of a simple expression - check it out yourselves.)</p>
<p>There are, however, plenty of situations where <span class="math inline">\(f\)</span> is available but <span class="math inline">\(\nabla f\)</span> is not; e.g.&nbsp;<span class="math inline">\(f\)</span> might be the result of some numerical procedure or an approximation obtained by simulation.</p>
<p>Next time you will see how to deal with such situations as well as see how to do constrained optimization.</p>
</section><section id="gradient-and-hessian-in-r" class="level2" data-number="9.5"><h2 data-number="9.5" class="anchored" data-anchor-id="gradient-and-hessian-in-r">
<span class="header-section-number">9.5</span> Gradient and Hessian in R</h2>
<p>We saw that the <code>grad</code>function in the <code>numDeriv</code> package can help us to compute the gradient of <code>f</code>:</p>
<p><code>grad(f, x, ...)</code></p>
<p>The <code>numDeriv</code> package also provides us the <code>hessian</code> function:</p>
<p><code>hessian(f, x, ...)</code></p>
<p>See <code>help(hessian)</code>. (Remember to load <code>numDeriv</code> with <code><a href="http://optimizer.r-forge.r-project.org/">library(numDeriv)</a></code>).</p>
</section><section id="optimization-in-r-multivariate" class="level2" data-number="9.6"><h2 data-number="9.6" class="anchored" data-anchor-id="optimization-in-r-multivariate">
<span class="header-section-number">9.6</span> Optimization in R: multivariate</h2>
<p>In higher dimensions there are a variety of optimization methods in current use. The R function <code>optim</code> provides functionalities to maximize a multivariate function:</p>
<p><code>optim(par, fn, gr = NULL, ..., method = c("Nelder-Mead", "BFGS", "CG", "L-BFGS-B", "SANN", "Brent"), lower = -Inf, upper = Inf, control = list(), hessian = FALSE)</code></p>
<p>Where the <code>method</code> argument specifies the type of optimizer we want to employ. The most used are:</p>
<ul>
<li><p><code>method = "Nelder-Mead"</code> the Nelder and Mead<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, method.</p></li>
<li><p><code>method = "BFGS"</code> is a quasi-Newton method.</p></li>
<li><p><code>method = "L-BFGS-B"</code> of Byrd et. al.&nbsp;(1995)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> which allows box constraints.</p></li>
</ul>
<section id="example-2" class="level3" data-number="9.6.1"><h3 data-number="9.6.1" class="anchored" data-anchor-id="example-2">
<span class="header-section-number">9.6.1</span> Example</h3>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fnscale multiplies the function by -1, such that a maximum is found. </span></span>
<span><span class="co"># the default is a minimum</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">1.2</span><span class="op">)</span>, <span class="va">f</span>, gr <span class="op">=</span> <span class="va">grad.f</span>, method <span class="op">=</span> <span class="st">"BFGS"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] 2.030697 1.401526</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       22        9 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Nelder, J. A. and Mead, R. (1965) A simplex algorithm for function minimization. Computer Journal 7, 308-313.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Byrd, R. H., Lu, P., Nocedal, J. and Zhu, C. (1995) A limited memory algorithm for bound constrained optimization. SIAM J. Scientific Computing, 16, 1190-1208.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./numericaloptimization1.html" class="pagination-link" aria-label="Numerical Optimization 1">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Numerical Optimization 1</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./constrainedandpitfalls.html" class="pagination-link" aria-label="Constrained Optimization and Pitfalls in Optimization">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Constrained Optimization and Pitfalls in Optimization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>