<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>28&nbsp; Extra exercises – Notes for 3611: Programming in Quantitative Economics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./advanced_exercises.html" rel="next">
<link href="./exam2024retake.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ecba78ac1d23ec93bb40517a5fbc1f6e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./problemsets.html">Problem sets</a></li><li class="breadcrumb-item"><a href="./extra_exercises.html"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Extra exercises</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Notes for 3611: Programming in Quantitative Economics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./lectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to the Course</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started_with_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basic_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Basic Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programming_w_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programming with Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./efficiency_and_parallel_computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Program Efficiency and Parallel Computing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction_to_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rootfinding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Root-finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numericaloptimization1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Numerical Optimization 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numericaloptimization2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Numerical Optimization 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./constrainedandpitfalls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Constrained Optimization and Pitfalls in Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cpp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Integration of C++ Code with Rcpp</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Creating R packages with RStudio</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./problemsets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem sets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exercise set 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Exercise set 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Exercise set 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Exercise set 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Exercise set 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./problemset6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Exercise set 6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2020.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Ordinary exam 2020</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2021.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ordinary exam 2021</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2021re.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Retake exam 2021</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2022.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Ordinary exam 2022</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2022re.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Retake exam 2022</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2023.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Ordinary exam 2023</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2023re.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Retake exam 2023</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2024.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Ordinary exam 2024</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exam2024retake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Retake exam 2024</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extra_exercises.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Extra exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./advanced_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Advanced exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extra_extra_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Extra extra exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./likelihood_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Likelihood Exercises</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#exercise-set-1-r-basics-data-structures-and-control-flow" id="toc-exercise-set-1-r-basics-data-structures-and-control-flow" class="nav-link active" data-scroll-target="#exercise-set-1-r-basics-data-structures-and-control-flow"><span class="header-section-number">29</span> Exercise Set 1: R Basics, Data Structures, and Control Flow</a>
  <ul class="collapse">
<li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">29.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">29.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">29.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"><span class="header-section-number">29.4</span> <strong>(4)</strong></a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"><span class="header-section-number">29.5</span> <strong>(5)</strong></a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"><span class="header-section-number">29.6</span> <strong>(6)</strong></a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"><span class="header-section-number">29.7</span> <strong>(7)</strong></a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"><span class="header-section-number">29.8</span> <strong>(8)</strong></a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"><span class="header-section-number">29.9</span> <strong>(9)</strong></a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"><span class="header-section-number">29.10</span> <strong>(10)</strong></a></li>
  </ul>
</li>
  <li>
<a href="#exercise-set-2-functions-scope-and-efficiency" id="toc-exercise-set-2-functions-scope-and-efficiency" class="nav-link" data-scroll-target="#exercise-set-2-functions-scope-and-efficiency"><span class="header-section-number">30</span> Exercise Set 2: Functions, Scope, and Efficiency</a>
  <ul class="collapse">
<li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10"><span class="header-section-number">30.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11"><span class="header-section-number">30.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-12" id="toc-section-12" class="nav-link" data-scroll-target="#section-12"><span class="header-section-number">30.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-13" id="toc-section-13" class="nav-link" data-scroll-target="#section-13"><span class="header-section-number">30.4</span> <strong>(4)</strong></a></li>
  <li><a href="#section-14" id="toc-section-14" class="nav-link" data-scroll-target="#section-14"><span class="header-section-number">30.5</span> <strong>(5)</strong></a></li>
  <li><a href="#section-15" id="toc-section-15" class="nav-link" data-scroll-target="#section-15"><span class="header-section-number">30.6</span> <strong>(6)</strong></a></li>
  <li><a href="#section-16" id="toc-section-16" class="nav-link" data-scroll-target="#section-16"><span class="header-section-number">30.7</span> <strong>(7)</strong></a></li>
  <li><a href="#section-17" id="toc-section-17" class="nav-link" data-scroll-target="#section-17"><span class="header-section-number">30.8</span> <strong>(8)</strong></a></li>
  <li><a href="#section-18" id="toc-section-18" class="nav-link" data-scroll-target="#section-18"><span class="header-section-number">30.9</span> <strong>(9)</strong></a></li>
  <li><a href="#section-19" id="toc-section-19" class="nav-link" data-scroll-target="#section-19"><span class="header-section-number">30.10</span> <strong>(10)</strong></a></li>
  </ul>
</li>
  <li>
<a href="#exercise-set-3-simulation" id="toc-exercise-set-3-simulation" class="nav-link" data-scroll-target="#exercise-set-3-simulation"><span class="header-section-number">31</span> Exercise Set 3: Simulation</a>
  <ul class="collapse">
<li><a href="#section-20" id="toc-section-20" class="nav-link" data-scroll-target="#section-20"><span class="header-section-number">31.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-21" id="toc-section-21" class="nav-link" data-scroll-target="#section-21"><span class="header-section-number">31.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-22" id="toc-section-22" class="nav-link" data-scroll-target="#section-22"><span class="header-section-number">31.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-23" id="toc-section-23" class="nav-link" data-scroll-target="#section-23"><span class="header-section-number">31.4</span> <strong>(4)</strong></a></li>
  <li><a href="#section-24" id="toc-section-24" class="nav-link" data-scroll-target="#section-24"><span class="header-section-number">31.5</span> <strong>(5)</strong></a></li>
  <li><a href="#section-25" id="toc-section-25" class="nav-link" data-scroll-target="#section-25"><span class="header-section-number">31.6</span> <strong>(6)</strong></a></li>
  <li><a href="#section-26" id="toc-section-26" class="nav-link" data-scroll-target="#section-26"><span class="header-section-number">31.7</span> <strong>(7)</strong></a></li>
  </ul>
</li>
  <li>
<a href="#exercise-set-4-root-finding" id="toc-exercise-set-4-root-finding" class="nav-link" data-scroll-target="#exercise-set-4-root-finding"><span class="header-section-number">32</span> Exercise Set 4: Root-Finding</a>
  <ul class="collapse">
<li><a href="#section-27" id="toc-section-27" class="nav-link" data-scroll-target="#section-27"><span class="header-section-number">32.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-28" id="toc-section-28" class="nav-link" data-scroll-target="#section-28"><span class="header-section-number">32.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-29" id="toc-section-29" class="nav-link" data-scroll-target="#section-29"><span class="header-section-number">32.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-30" id="toc-section-30" class="nav-link" data-scroll-target="#section-30"><span class="header-section-number">32.4</span> <strong>(4)</strong></a></li>
  <li><a href="#section-31" id="toc-section-31" class="nav-link" data-scroll-target="#section-31"><span class="header-section-number">32.5</span> <strong>(5)</strong></a></li>
  <li><a href="#section-32" id="toc-section-32" class="nav-link" data-scroll-target="#section-32"><span class="header-section-number">32.6</span> <strong>(6)</strong></a></li>
  </ul>
</li>
  <li>
<a href="#exercise-set-5-numerical-optimization-univariate-and-multivariate" id="toc-exercise-set-5-numerical-optimization-univariate-and-multivariate" class="nav-link" data-scroll-target="#exercise-set-5-numerical-optimization-univariate-and-multivariate"><span class="header-section-number">33</span> Exercise Set 5: Numerical Optimization (Univariate and Multivariate)</a>
  <ul class="collapse">
<li><a href="#section-33" id="toc-section-33" class="nav-link" data-scroll-target="#section-33"><span class="header-section-number">33.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-34" id="toc-section-34" class="nav-link" data-scroll-target="#section-34"><span class="header-section-number">33.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-35" id="toc-section-35" class="nav-link" data-scroll-target="#section-35"><span class="header-section-number">33.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-36" id="toc-section-36" class="nav-link" data-scroll-target="#section-36"><span class="header-section-number">33.4</span> <strong>(4)</strong></a></li>
  <li><a href="#section-37" id="toc-section-37" class="nav-link" data-scroll-target="#section-37"><span class="header-section-number">33.5</span> <strong>(5)</strong></a></li>
  <li><a href="#section-38" id="toc-section-38" class="nav-link" data-scroll-target="#section-38"><span class="header-section-number">33.6</span> <strong>(6)</strong></a></li>
  <li><a href="#section-39" id="toc-section-39" class="nav-link" data-scroll-target="#section-39"><span class="header-section-number">33.7</span> <strong>(7)</strong></a></li>
  <li><a href="#section-40" id="toc-section-40" class="nav-link" data-scroll-target="#section-40"><span class="header-section-number">33.8</span> <strong>(8)</strong></a></li>
  </ul>
</li>
  <li>
<a href="#exercise-set-6-c-with-rcpp-and-rcpparmadillo" id="toc-exercise-set-6-c-with-rcpp-and-rcpparmadillo" class="nav-link" data-scroll-target="#exercise-set-6-c-with-rcpp-and-rcpparmadillo"><span class="header-section-number">34</span> Exercise Set 6: C++ with Rcpp and RcppArmadillo</a>
  <ul class="collapse">
<li><a href="#section-41" id="toc-section-41" class="nav-link" data-scroll-target="#section-41"><span class="header-section-number">34.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-42" id="toc-section-42" class="nav-link" data-scroll-target="#section-42"><span class="header-section-number">34.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-43" id="toc-section-43" class="nav-link" data-scroll-target="#section-43"><span class="header-section-number">34.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-44" id="toc-section-44" class="nav-link" data-scroll-target="#section-44"><span class="header-section-number">34.4</span> <strong>(4)</strong></a></li>
  <li><a href="#section-45" id="toc-section-45" class="nav-link" data-scroll-target="#section-45"><span class="header-section-number">34.5</span> <strong>(5)</strong></a></li>
  <li><a href="#section-46" id="toc-section-46" class="nav-link" data-scroll-target="#section-46"><span class="header-section-number">34.6</span> <strong>(6)</strong></a></li>
  </ul>
</li>
  <li>
<a href="#exercise-set-7-creating-r-packages" id="toc-exercise-set-7-creating-r-packages" class="nav-link" data-scroll-target="#exercise-set-7-creating-r-packages"><span class="header-section-number">35</span> Exercise Set 7: Creating R Packages</a>
  <ul class="collapse">
<li><a href="#section-47" id="toc-section-47" class="nav-link" data-scroll-target="#section-47"><span class="header-section-number">35.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-48" id="toc-section-48" class="nav-link" data-scroll-target="#section-48"><span class="header-section-number">35.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-49" id="toc-section-49" class="nav-link" data-scroll-target="#section-49"><span class="header-section-number">35.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-50" id="toc-section-50" class="nav-link" data-scroll-target="#section-50"><span class="header-section-number">35.4</span> <strong>(4)</strong></a></li>
  <li><a href="#section-51" id="toc-section-51" class="nav-link" data-scroll-target="#section-51"><span class="header-section-number">35.5</span> <strong>(5)</strong></a></li>
  </ul>
</li>
  <li>
<a href="#exercise-set-8-parallel-computing" id="toc-exercise-set-8-parallel-computing" class="nav-link" data-scroll-target="#exercise-set-8-parallel-computing"><span class="header-section-number">36</span> Exercise Set 8: Parallel Computing</a>
  <ul class="collapse">
<li><a href="#section-52" id="toc-section-52" class="nav-link" data-scroll-target="#section-52"><span class="header-section-number">36.1</span> <strong>(1)</strong></a></li>
  <li><a href="#section-53" id="toc-section-53" class="nav-link" data-scroll-target="#section-53"><span class="header-section-number">36.2</span> <strong>(2)</strong></a></li>
  <li><a href="#section-54" id="toc-section-54" class="nav-link" data-scroll-target="#section-54"><span class="header-section-number">36.3</span> <strong>(3)</strong></a></li>
  <li><a href="#section-55" id="toc-section-55" class="nav-link" data-scroll-target="#section-55"><span class="header-section-number">36.4</span> <strong>(4)</strong></a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./problemsets.html">Problem sets</a></li><li class="breadcrumb-item"><a href="./extra_exercises.html"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Extra exercises</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Extra exercises</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="exercise-set-1-r-basics-data-structures-and-control-flow" class="level1" data-number="29"><h1 data-number="29">
<span class="header-section-number">29</span> Exercise Set 1: R Basics, Data Structures, and Control Flow</h1>
<section id="section" class="level2" data-number="29.1"><h2 data-number="29.1" class="anchored" data-anchor-id="section">
<span class="header-section-number">29.1</span> <strong>(1)</strong>
</h2>
<ul>
<li><ol type="a">
<li>Create a vector <code>vNumbers</code> containing integers from 1 to 50.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Calculate the sum of all even numbers in <code>vNumbers</code>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Create a new vector <code>vLog</code> containing the natural logarithm of each number in <code>vNumbers</code>. Handle any potential warnings or errors if numbers were 0 or negative (though not the case here).</li>
</ol></li>
<li><ol start="4" type="a">
<li>What is the data type of <code>vLog</code>?</li>
</ol></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vNumbers</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">vNumbers</span><span class="op">[</span><span class="va">vNumbers</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 650</span></span>
<span><span class="va">vLog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">vNumbers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">vLog</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "double"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-1" class="level2" data-number="29.2"><h2 data-number="29.2" class="anchored" data-anchor-id="section-1">
<span class="header-section-number">29.2</span> <strong>(2)</strong>
</h2>
<ul>
<li><ol type="a">
<li>Create a 5x5 matrix <code>mRandom</code> with elements drawn from a uniform distribution between -10 and 10. Set the seed to 42.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Replace all negative values in <code>mRandom</code> with NA.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Calculate the sum of each row, ignoring NA values.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Calculate the mean of each column, ignoring NA values.</li>
</ol></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">mRandom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">25</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">mRandom</span><span class="op">[</span><span class="va">mRandom</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">mRandom</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 25.558958 27.420048 18.471280 18.682163  8.142861</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">mRandom</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.620373 3.088707 6.537845 6.523825 8.930609</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-2" class="level2" data-number="29.3"><h2 data-number="29.3" class="anchored" data-anchor-id="section-2">
<span class="header-section-number">29.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>Write an R script that does the following:
<ul>
<li>Initializes a variable <code>dTotalSum</code> to 0.</li>
<li>Uses a <code>for</code> loop to iterate from 1 to 100.</li>
<li>In each iteration, if the current number <code>i</code> is a multiple of 3 or a multiple of 5, add <code>i</code> to <code>dTotalSum</code>.</li>
<li>Print the final <code>dTotalSum</code>.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dTotalSum</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">3</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">5</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dTotalSum</span> <span class="op">&lt;-</span> <span class="va">dTotalSum</span> <span class="op">+</span> <span class="va">i</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">dTotalSum</span></span>
<span><span class="co">#&gt; [1] 2418</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-3" class="level2" data-number="29.4"><h2 data-number="29.4" class="anchored" data-anchor-id="section-3">
<span class="header-section-number">29.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>Create a list <code>lMyList</code> with the following named elements:
<ul>
<li>
<code>sName</code>: Your name (as a string).</li>
<li>
<code>vLuckyNumbers</code>: A vector of your 3 favorite numbers.</li>
<li>
<code>mMatrixA</code>: A 2x2 identity matrix.</li>
<li>
<code>dfInnerData</code>: A data frame with two columns: <code>Month</code> (Jan, Feb, Mar) and <code>Rainfall_mm</code> (50, 30, 65).</li>
</ul>
</li>
<li>Access and print the <code>Rainfall_mm</code> for February.</li>
<li>Add a new element to the list called <code>sCourse</code> with the value “PQE”.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lMyList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  sName <span class="op">=</span> <span class="st">"MyName"</span>,</span>
<span>  vLuckyNumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  mMatrixA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identity.html">identity</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  dfInnerData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span><span class="op">)</span>,</span>
<span>    Rainfall_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">30</span>, <span class="fl">65</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">lMyList</span><span class="op">$</span><span class="va">dfInnerData</span><span class="op">$</span><span class="va">Rainfall_mm</span><span class="op">[</span><span class="va">lMyList</span><span class="op">$</span><span class="va">dfInnerData</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="st">"Feb"</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 30</span></span>
<span><span class="va">lMyList</span><span class="op">$</span><span class="va">sCourse</span> <span class="op">&lt;-</span> <span class="st">"PQE"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-4" class="level2" data-number="29.5"><h2 data-number="29.5" class="anchored" data-anchor-id="section-4">
<span class="header-section-number">29.5</span> <strong>(5)</strong>
</h2>
<ul>
<li><ol type="a">
<li>Create a data frame <code>dfStudents</code> with 5 students and 3 variables: <code>StudentID</code> (101 to 105), <code>Grade</code> (A, B, C, A, B), and <code>Age</code> (20, 21, 20, 22, 21).</li>
</ol></li>
<li><ol start="2" type="a">
<li>Convert the <code>Grade</code> column to an ordered factor with levels C &lt; B &lt; A.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Add a new column <code>Pass</code> which is <code>TRUE</code> if <code>Grade</code> is A or B, and <code>FALSE</code> otherwise.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Create a subset of <code>dfStudents</code> containing only students older than 20.</li>
</ol></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dfStudents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  StudentID <span class="op">=</span> <span class="fl">101</span><span class="op">:</span><span class="fl">105</span>,</span>
<span>  Grade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>  Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">20</span>, <span class="fl">22</span>, <span class="fl">21</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dfStudents</span><span class="op">$</span><span class="va">Grade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dfStudents</span><span class="op">$</span><span class="va">Grade</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dfStudents</span><span class="op">$</span><span class="va">Pass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">dfStudents</span><span class="op">$</span><span class="va">Grade</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">|</span> <span class="va">dfStudents</span><span class="op">$</span><span class="va">Grade</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dfStudents</span><span class="op">[</span><span class="va">dfStudents</span><span class="op">$</span><span class="va">Age</span> <span class="op">&gt;</span> <span class="fl">20</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;   StudentID Grade Age Pass</span></span>
<span><span class="co">#&gt; 2       102     B  21 TRUE</span></span>
<span><span class="co">#&gt; 4       104     A  22 TRUE</span></span>
<span><span class="co">#&gt; 5       105     B  21 TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-5" class="level2" data-number="29.6"><h2 data-number="29.6" class="anchored" data-anchor-id="section-5">
<span class="header-section-number">29.6</span> <strong>(6)</strong>
</h2>
<ul>
<li>Using <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>, create a vector <code>vSign</code> of length 20. For each element <code>i</code> from -9 to 10, <code>vSign[i+10]</code> should be -1 if <code>i</code> is negative, 0 if <code>i</code> is zero, and 1 if <code>i</code> is positive. (Adjust indexing as R vectors are 1-indexed).</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vI</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">9</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">vSign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">vI</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">vI</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vSign</span></span>
<span><span class="co">#&gt;  [1] -1 -1 -1 -1 -1 -1 -1 -1 -1  0  1  1  1  1  1  1  1  1  1  1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-6" class="level2" data-number="29.7"><h2 data-number="29.7" class="anchored" data-anchor-id="section-6">
<span class="header-section-number">29.7</span> <strong>(7)</strong>
</h2>
<ul>
<li>Write a <code>while</code> loop that simulates flipping a fair coin (0 for Tails, 1 for Heads) until 3 consecutive Heads are observed. Count and print the total number of flips. Set seed to 101.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span></span>
<span><span class="va">iFlipCount</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">iConsecHeads</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="va">iConsecHeads</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">iFlip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">iFlipCount</span> <span class="op">&lt;-</span> <span class="va">iFlipCount</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">iFlip</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">iConsecHeads</span> <span class="op">&lt;-</span> <span class="va">iConsecHeads</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">iConsecHeads</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">iFlipCount</span></span>
<span><span class="co">#&gt; [1] 36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-7" class="level2" data-number="29.8"><h2 data-number="29.8" class="anchored" data-anchor-id="section-7">
<span class="header-section-number">29.8</span> <strong>(8)</strong>
</h2>
<ul>
<li><ol type="a">
<li>Create a character vector <code>vsFruits</code> with elements: “apple”, “banana”, “cherry”, NA, “date”.</li>
</ol></li>
<li><ol start="2" type="a">
<li>How many missing values are in <code>vsFruits</code>?</li>
</ol></li>
<li><ol start="3" type="a">
<li>Create a new vector <code>vsFruitsClean</code> by removing NA values from <code>vsFruits</code>.</li>
</ol></li>
<li><ol start="4" type="a">
<li>For each fruit in <code>vsFruitsClean</code>, print the fruit name and its number of characters using <code><a href="https://rdrr.io/r/base/nchar.html">nchar()</a></code>.</li>
</ol></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vsFruits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cherry"</span>, <span class="cn">NA</span>, <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">vsFruits</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="va">vsFruitsClean</span> <span class="op">&lt;-</span> <span class="va">vsFruits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">vsFruits</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">fruit</span> <span class="kw">in</span> <span class="va">vsFruitsClean</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fruit</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">fruit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "apple"</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; [1] "banana"</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; [1] "cherry"</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; [1] "date"</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-8" class="level2" data-number="29.9"><h2 data-number="29.9" class="anchored" data-anchor-id="section-8">
<span class="header-section-number">29.9</span> <strong>(9)</strong>
</h2>
<ul>
<li>Explain the difference between <code>&amp;</code> and <code>&amp;&amp;</code>, and between <code>|</code> and <code>||</code> in R. Provide a small example where <code>&amp;&amp;</code> or <code>||</code> would be preferred over <code>&amp;</code> or <code>|</code> due to short-circuiting, especially when dealing with potentially undefined objects or expensive computations.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#`&amp;` and `|` are element-wise. `&amp;&amp;` and `||` are short-circuiting, evaluating only the first element. Example:</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="co"># No error</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span> <span class="op">&amp;&amp;</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Not evaluated"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"OK"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Error if x[1] is problematic</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Error here"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-9" class="level2" data-number="29.10"><h2 data-number="29.10" class="anchored" data-anchor-id="section-9">
<span class="header-section-number">29.10</span> <strong>(10)</strong>
</h2>
<ul>
<li>Consider the matrix <code>mA &lt;- matrix(1:12, nrow=4, byrow=TRUE)</code>.</li>
<li>Extract the second row.</li>
<li>Extract the third column.</li>
<li>Extract the element in the 1st row and 2nd column.</li>
<li>Create a new matrix <code>mB</code> by selecting rows 1 and 3, and columns 2 and 3 from <code>mA</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mA</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; [1] 4 5 6</span></span>
<span><span class="va">mA</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1]  3  6  9 12</span></span>
<span><span class="va">mA</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="va">mB</span> <span class="op">&lt;-</span> <span class="va">mA</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mB</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    2    3</span></span>
<span><span class="co">#&gt; [2,]    8    9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exercise-set-2-functions-scope-and-efficiency" class="level1" data-number="30"><h1 data-number="30">
<span class="header-section-number">30</span> Exercise Set 2: Functions, Scope, and Efficiency</h1>
<section id="section-10" class="level2" data-number="30.1"><h2 data-number="30.1" class="anchored" data-anchor-id="section-10">
<span class="header-section-number">30.1</span> <strong>(1)</strong>
</h2>
<ul>
<li>Write an R function <code>fCalculateStats</code> that takes a numeric vector as input.</li>
<li>The function should return a list containing:
<ul>
<li>
<code>dMean</code>: The mean of the vector.</li>
<li>
<code>dMedian</code>: The median of the vector.</li>
<li>
<code>dSD</code>: The standard deviation of the vector.</li>
<li>
<code>iNAs</code>: The number of NA values in the vector.</li>
</ul>
</li>
<li>The function should handle NA values gracefully by removing them before calculating mean, median, and SD.</li>
<li>Test your function with <code>vTest &lt;- c(1, 5, NA, 7, 3, NA, 8)</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fCalculateStats</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vInput</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">outputList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    dMean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vInput</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    dMedian <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">vInput</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    dSD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">vInput</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    iNAs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">vInput</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">outputList</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">vTest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="cn">NA</span>, <span class="fl">7</span>, <span class="fl">3</span>, <span class="cn">NA</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu">fCalculateStats</span><span class="op">(</span><span class="va">vTest</span><span class="op">)</span></span>
<span><span class="co">#&gt; $dMean</span></span>
<span><span class="co">#&gt; [1] 4.8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dMedian</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dSD</span></span>
<span><span class="co">#&gt; [1] 2.863564</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iNAs</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-11" class="level2" data-number="30.2"><h2 data-number="30.2" class="anchored" data-anchor-id="section-11">
<span class="header-section-number">30.2</span> <strong>(2)</strong>
</h2>
<ul>
<li>Consider the following R code:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">my_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">my_func</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>What are the values of <code>x</code> and <code>z</code> in the global environment after this code is executed? Explain R’s scoping rules in this context.</li>
</ul>
<p>The value of <code>z</code> is 8, and the value of <code>x</code> is 10. <code>x</code> is local within the function.</p>
</section><section id="section-12" class="level2" data-number="30.3"><h2 data-number="30.3" class="anchored" data-anchor-id="section-12">
<span class="header-section-number">30.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>Write a function <code>fSumSquaresUpToN</code> that calculates the sum of squares of integers from 1 up to <code>n</code> (i.e., <span class="math inline">\(1^2 + 2^2 + ... + n^2\)</span>).</li>
<li>Implement this first using a <code>for</code> loop.</li>
<li>Implement this second using a vectorized approach (without an explicit loop).</li>
<li>Use <code><a href="https://rdrr.io/r/base/system.time.html">system.time()</a></code> or <code><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark()</a></code> to compare the execution time of both versions for <code>n = 10000</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/">microbenchmark</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: pakke 'microbenchmark' blev bygget under R version 4.3.3</span></span>
<span></span>
<span><span class="va">fSumSquaresUpToN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">iN</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">iSumSquares</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">iN</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">iSumSquares</span> <span class="op">&lt;-</span> <span class="va">iSumSquares</span> <span class="op">+</span> <span class="va">i</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="op">}</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fSumSquaresVector</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">iN</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">iN</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span><span class="fu">fSumSquaresVector</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span>, <span class="fu">fSumSquaresUpToN</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: microseconds</span></span>
<span><span class="co">#&gt;                      expr   min     lq    mean median  uq    max neval</span></span>
<span><span class="co">#&gt;  fSumSquaresVector(10000)  24.4  56.85  73.568  58.45  61 1557.5   100</span></span>
<span><span class="co">#&gt;   fSumSquaresUpToN(10000) 222.8 224.50 249.487 225.95 227 2233.7   100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-13" class="level2" data-number="30.4"><h2 data-number="30.4" class="anchored" data-anchor-id="section-13">
<span class="header-section-number">30.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>Write a recursive R function <code>fRecursiveFactorial</code> to calculate the factorial of a non-negative integer <code>n</code>. Include basic error checking for negative inputs.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fRecursiveFactorial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Input must be non-negative"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fu">fRecursiveFactorial</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">fRecursiveFactorial</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 120</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-14" class="level2" data-number="30.5"><h2 data-number="30.5" class="anchored" data-anchor-id="section-14">
<span class="header-section-number">30.5</span> <strong>(5)</strong>
</h2>
<ul>
<li>Write a function <code>fApplyToMatrix</code> that takes a matrix and a function <code>FUN</code> as arguments.</li>
<li>The function should apply <code>FUN</code> to each column of the matrix using <code>sapply</code> or <code>apply</code>.</li>
<li>Test it by creating a 5x3 matrix of random numbers and applying the <code>mean</code> function to its columns.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fApplyToMatrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mInput</span>, <span class="va">FUN</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mInput</span>, <span class="fl">2</span>, <span class="va">FUN</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">fApplyToMatrix</span><span class="op">(</span><span class="va">mA</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.360807854 -0.005839041 -0.312895340</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-15" class="level2" data-number="30.6"><h2 data-number="30.6" class="anchored" data-anchor-id="section-15">
<span class="header-section-number">30.6</span> <strong>(6)</strong>
</h2>
<ul>
<li>Explain the purpose of the ellipsis (<code>...</code>) argument in R functions. Provide an example of a simple function you write that uses <code>...</code> to pass arguments to an internal R function (e.g., <code>plot</code> or <code>mean</code>).</li>
</ul>
<p>It passes additional arguments.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fCalculateMean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vInput</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vInput</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu">fCalculateMean</span><span class="op">(</span><span class="va">vX</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.666667</span></span>
<span></span>
<span><span class="va">myPlotWrapper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, main <span class="op">=</span> <span class="st">"My Plot Wrapper"</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">myPlotWrapper</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, xlab <span class="op">=</span> <span class="st">"X-Values"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-16" class="level2" data-number="30.7"><h2 data-number="30.7" class="anchored" data-anchor-id="section-16">
<span class="header-section-number">30.7</span> <strong>(7)</strong>
</h2>
<ul>
<li>Create two numeric vectors, <code>vA = 1:1000000</code> and <code>vB = rnorm(1000000)</code>.</li>
<li>Compare the time it takes to calculate their element-wise product using:
<ul>
<li>A <code>for</code> loop.</li>
<li>The vectorized <code>*</code> operator.</li>
</ul>
</li>
<li>Use <code>microbenchmark</code> for the comparison.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vA</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span></span>
<span><span class="va">vB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fLoopApproach</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vA</span>, <span class="va">vB</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">iProduct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vA</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vA</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">iProduct</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">vA</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">vB</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fVectorApproach</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vA</span>, <span class="va">vB</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vA</span> <span class="op">*</span> <span class="va">vB</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># microbenchmark(fLoopApproach(vA, vB), fVectorApproach(vA, vB))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-17" class="level2" data-number="30.8"><h2 data-number="30.8" class="anchored" data-anchor-id="section-17">
<span class="header-section-number">30.8</span> <strong>(8)</strong>
</h2>
<ul>
<li>You are given a list <code>lData</code> where each element is a numeric vector of varying lengths, possibly containing NAs.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">lData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">15</span>, mean<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Write code using <code>lapply</code> to return a new list where each element is the mean of the corresponding vector in <code>lData</code>, after removing NAs.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lDataClean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">lData</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">lDataClean</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 0.07462564</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 0.3079017</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 4.753408</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-18" class="level2" data-number="30.9"><h2 data-number="30.9" class="anchored" data-anchor-id="section-18">
<span class="header-section-number">30.9</span> <strong>(9)</strong>
</h2>
<ul>
<li>Write a function <code>fMatrixRedimension</code> that first initializes an empty vector <code>vResult &lt;- c()</code>.</li>
<li>Then, in a loop that runs 10,000 times, it appends the loop index <code>i</code> to <code>vResult</code> using <code>vResult &lt;- c(vResult, i)</code>.</li>
<li>Write a second function <code>fMatrixPreallocate</code> that first initializes <code>vResult &lt;- numeric(10000)</code>.</li>
<li>Then, in a loop that runs 10,000 times, it assigns <code>vResult[i] &lt;- i</code>.</li>
<li>Compare the execution time of these two functions. Explain the difference.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fMatrixRedimension</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">iN</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vResult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">iN</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vResult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">vResult</span>, <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fMatrixPreallocate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">iN</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vResult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">iN</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vResult</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># microbenchmark(fMatrixRedimension(10000), fMatrixPreallocate(10000))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-19" class="level2" data-number="30.10"><h2 data-number="30.10" class="anchored" data-anchor-id="section-19">
<span class="header-section-number">30.10</span> <strong>(10)</strong>
</h2>
<ul>
<li>When might you prefer using <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> over a standard <code>if-else</code> structure within a loop? Provide a small example.</li>
</ul>
<p>Use <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> for vectorized conditions. Loop <code>if-else</code> for scalar/complex logic per iteration.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"positive"</span>, <span class="st">"negative"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "negative" "negative" "negative" "positive" "positive"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exercise-set-3-simulation" class="level1" data-number="31"><h1 data-number="31">
<span class="header-section-number">31</span> Exercise Set 3: Simulation</h1>
<section id="section-20" class="level2" data-number="31.1"><h2 data-number="31.1" class="anchored" data-anchor-id="section-20">
<span class="header-section-number">31.1</span> <strong>(1)</strong>
</h2>
<ul>
<li>
<strong>Simulating a Biased Die Roll:</strong>
<ul>
<li>Write an R function <code>fSimulateBiasedDie</code> to simulate rolling a 6-sided die where the probability of rolling a ‘6’ is 0.3, and the probabilities of rolling ‘1’ through ‘5’ are equal (each 0.14).</li>
<li>The function should take an integer <code>n_rolls</code> as input and return a vector of <code>n_rolls</code> simulated outcomes.</li>
<li>Use the discrete random variable simulation method (using <code>runif</code> and comparing to CDF).</li>
<li>Generate 10,000 rolls and plot a histogram of the results.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fSimulateBiasedDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_rolls</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.14</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span>  <span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span></span>
<span>  <span class="va">CDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">vRolls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">n_rolls</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_rolls</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">vRolls</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">outcomes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">u</span> <span class="op">&lt;=</span> <span class="va">CDF</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vRolls</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">vOutcomes</span> <span class="op">&lt;-</span> <span class="fu">fSimulateBiasedDie</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">vOutcomes</span>, breaks <span class="op">=</span> <span class="fl">0.5</span><span class="op">:</span><span class="fl">6.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-21" class="level2" data-number="31.2"><h2 data-number="31.2" class="anchored" data-anchor-id="section-21">
<span class="header-section-number">31.2</span> <strong>(2)</strong>
</h2>
<ul>
<li>
<strong>Inverse Transform Sampling for a Custom Distribution:</strong>
<ul>
<li>A random variable X has a probability density function (PDF) <span class="math inline">\(f(x) = 3x^2\)</span> for <span class="math inline">\(0 \le x \le 1\)</span>, and <span class="math inline">\(f(x)=0\)</span> otherwise.</li>
<li><ol type="a">
<li>Find the cumulative distribution function (CDF), <span class="math inline">\(F(x)\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Find the inverse CDF, <span class="math inline">\(F^{-1}(u)\)</span>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Write an R function <code>fSimulateCustom</code> to generate <code>n</code> random samples from this distribution using the inverse transform method.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Generate 10,000 samples and plot a histogram. Superimpose the theoretical PDF on the histogram.</li>
</ol></li>
</ul>
</li>
</ul>
<p>The CDF is <span class="math inline">\(F(x)=x^3\)</span>. So the inverse CDF is <span class="math inline">\(F^{-1}(u)=u^{1/3}\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fSimulateCustom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">U</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu">fSimulateCustom</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">vX</span>, </span>
<span>     freq <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     breaks <span class="op">=</span> <span class="fl">15</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"cornflowerblue"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">""</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">""</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>      from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      to <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"red"</span>,      </span>
<span>      lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-22" class="level2" data-number="31.3"><h2 data-number="31.3" class="anchored" data-anchor-id="section-22">
<span class="header-section-number">31.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>
<strong>Acceptance-Rejection Method for a Truncated Normal:</strong>
<ul>
<li>You want to simulate from a standard normal distribution truncated to the interval [0, 2]. The PDF is <span class="math inline">\(f(x) = \frac{\phi(x)}{\Phi(2)-\Phi(0)}\)</span> for <span class="math inline">\(0 \le x \le 2\)</span>, where <span class="math inline">\(\phi\)</span> is the standard normal PDF and <span class="math inline">\(\Phi\)</span> is the standard normal CDF.</li>
<li>Use a uniform distribution on [0, 2] as the proposal distribution <span class="math inline">\(g(x) = 1/2\)</span> for <span class="math inline">\(0 \le x \le 2\)</span>.</li>
<li><ol type="a">
<li>Determine the constant <span class="math inline">\(c\)</span> such that <span class="math inline">\(f(x) \le c \cdot g(x)\)</span> for all <span class="math inline">\(x \in [0, 2]\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Write an R function <code>fSimulateTruncNormAR</code> using the acceptance-rejection method to generate <code>n</code> samples from this truncated normal distribution.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Generate 10,000 samples. Plot a histogram and superimpose the theoretical PDF.</li>
</ol></li>
<li><ol start="4" type="a">
<li>What is the acceptance rate of your sampler?</li>
</ol></li>
</ul>
</li>
</ul>
<ol type="a">
<li>
</li></ol>
<p><span class="math display">\[
c = \frac{\phi(0)}{\Phi(2)-\Phi(0)} / \frac{1}{2-0} \approx 1.6716
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fTruncNormSim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">c</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">0.5</span></span>
<span>  </span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">size</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">size</span><span class="op">)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">size</span><span class="op">)</span></span>
<span>  <span class="va">Unaccepted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="va">size</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">Unaccepted</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">UnacceptedCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Unaccepted</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">UnacceptedCount</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">UnacceptedCount</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">Accepted_ThisTime</span> <span class="op">&lt;-</span> <span class="va">Unaccepted</span><span class="op">[</span><span class="va">Unaccepted</span><span class="op">]</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">U</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">Y</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">c</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">X</span><span class="op">[</span><span class="va">Unaccepted</span><span class="op">]</span><span class="op">[</span><span class="va">Accepted_ThisTime</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">Accepted_ThisTime</span><span class="op">]</span></span>
<span>    <span class="va">Unaccepted</span><span class="op">[</span><span class="va">Unaccepted</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">Accepted_ThisTime</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">fTruncNormSim</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">X</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"cornflowerblue"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">50</span>, main <span class="op">=</span> <span class="st">"Truncated Normal (A-R)"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-23" class="level2" data-number="31.4"><h2 data-number="31.4" class="anchored" data-anchor-id="section-23">
<span class="header-section-number">31.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>
<strong>Box-Muller Transform:</strong>
<ul>
<li><ol type="a">
<li>Write an R function <code>fMyBoxMuller</code> that implements the Box-Muller algorithm to generate <code>n_pairs</code> of independent standard normal random variables. The function should return a list or a matrix with two columns/elements.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Generate 10,000 standard normal random variables (i.e., call your function to generate 5,000 pairs). Combine them into a single vector.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Plot a histogram of these 10,000 variables and superimpose the standard normal PDF.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Create a scatter plot of the pairs of normal variables generated. What pattern do you expect?</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fMyBoxMuller</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span></span>
<span>  <span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">V</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">V</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mX</span> <span class="op">&lt;-</span> <span class="fu">fMyBoxMuller</span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">mX</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">vX</span>, </span>
<span>     freq <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     breaks <span class="op">=</span> <span class="fl">15</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"cornflowerblue"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">""</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">""</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>      from <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>      to <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"red"</span>,      </span>
<span>      lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Expected: circular pattern centered at (0,0)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mX</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">mX</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, pch <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-24" class="level2" data-number="31.5"><h2 data-number="31.5" class="anchored" data-anchor-id="section-24">
<span class="header-section-number">31.5</span> <strong>(5)</strong>
</h2>
<ul>
<li>
<strong>Monte Carlo Integration:</strong>
<ul>
<li><ol type="a">
<li>Estimate the value of <span class="math inline">\(\int_{0}^{1} e^{x^2} dx\)</span> using Monte Carlo integration with 10,000 uniform random samples from [0, 1].</li>
</ol></li>
<li><ol start="2" type="a">
<li>The <code><a href="https://rdrr.io/r/stats/integrate.html">integrate()</a></code> function in R can compute this numerically. Compare your Monte Carlo estimate to the result from <code>integrate(function(x) exp(x^2), lower = 0, upper = 1)</code>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>How could you improve the accuracy of your Monte Carlo estimate?</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MonteCarlo.Integration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="va">a</span>, max <span class="op">=</span> <span class="va">b</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span> <span class="op">(</span><span class="va">b</span><span class="op">-</span><span class="va">a</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">U</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10086</span><span class="op">)</span></span>
<span><span class="fu">MonteCarlo.Integration</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">10000</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.45782</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/integrate.html">integrate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.462652 with absolute error &lt; 1.6e-14</span></span>
<span></span>
<span><span class="co"># Improve by increasing the number of samples.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-25" class="level2" data-number="31.6"><h2 data-number="31.6" class="anchored" data-anchor-id="section-25">
<span class="header-section-number">31.6</span> <strong>(6)</strong>
</h2>
<ul>
<li>
<strong>Simulating a Poisson Distribution:</strong>
<ul>
<li>The CDF of a Poisson distribution with rate <span class="math inline">\(\lambda\)</span> is <span class="math inline">\(F(k; \lambda) = \sum_{i=0}^{k} \frac{e^{-\lambda}\lambda^i}{i!}\)</span>.</li>
<li>Write an R function <code>fSimulatePoissonDiscrete</code> using the method for simulating discrete random variables (based on <code>runif</code> and the CDF) to generate <code>n</code> samples from a Poisson distribution with <span class="math inline">\(\lambda = 3\)</span>.</li>
<li>(Hint: You can use <code>ppois</code> to get the CDF values, or implement the sum yourself).</li>
<li>Generate 1,000 samples and compare its histogram to the one generated by <code>rpois(1000, lambda = 3)</code>.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fSimulatePoissonDiscrete</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">F</span>, <span class="va">size</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">size</span><span class="op">)</span></span>
<span>  <span class="va">X</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html">F</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">...</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">U</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html">F</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">...</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">U</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">X</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html">F</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">...</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">U</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html">F</a></span><span class="op">(</span><span class="va">m</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">...</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">U</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fPoissonCDF</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span>, <span class="va">lambda</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dSum</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dSum</span> <span class="op">&lt;-</span> <span class="va">dSum</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">lambda</span><span class="op">)</span> <span class="op">*</span> <span class="va">lambda</span><span class="op">^</span><span class="va">i</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">factorial</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dSum</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10086</span><span class="op">)</span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu">fSimulatePoissonDiscrete</span><span class="op">(</span><span class="va">fPoissonCDF</span>, size <span class="op">=</span> <span class="fl">1000</span>, lambda <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">vX</span>, </span>
<span>     breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"cornflowerblue"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Custom Poisson"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">1000</span>, lambda <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>     breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"cornflowerblue"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"R's rpois"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-26" class="level2" data-number="31.7"><h2 data-number="31.7" class="anchored" data-anchor-id="section-26">
<span class="header-section-number">31.7</span> <strong>(7)</strong>
</h2>
<ul>
<li>
<strong>Seeding and Reproducibility:</strong>
<ul>
<li><ol type="a">
<li>Generate a vector of 5 random numbers from a standard normal distribution.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Generate another vector of 5 random numbers from a standard normal distribution. Are they the same as in (a)?</li>
</ol></li>
<li><ol start="3" type="a">
<li>Set the seed to 12345. Generate a vector of 5 random numbers from a standard normal distribution.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Set the seed to 12345 again. Generate another vector of 5 random numbers from a standard normal distribution. Are they the same as in (c)? Explain why.</li>
</ol></li>
<li><ol start="5" type="a">
<li>How can you save and restore the RNG state in R? Demonstrate with an example.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vRand1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">vRand2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">vRand1</span> <span class="op">-</span> <span class="va">vRand2</span></span>
<span><span class="co">#&gt; [1]  0.02333262 -0.90672903 -2.01327089  1.66283561  0.14078765</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">vRand1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">RNG.state</span> <span class="op">&lt;-</span> <span class="va">.Random.seed</span></span>
<span><span class="va">vRand2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">vRand1</span> <span class="op">-</span> <span class="va">vRand2</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0</span></span>
<span><span class="va">.Random.seed</span> <span class="op">&lt;-</span> <span class="va">RNG.state</span></span>
<span><span class="va">vRand3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">vRand1</span> <span class="op">-</span> <span class="va">vRand3</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exercise-set-4-root-finding" class="level1" data-number="32"><h1 data-number="32">
<span class="header-section-number">32</span> Exercise Set 4: Root-Finding</h1>
<section id="section-27" class="level2" data-number="32.1"><h2 data-number="32.1" class="anchored" data-anchor-id="section-27">
<span class="header-section-number">32.1</span> <strong>(1)</strong>
</h2>
<ul>
<li>
<strong>Loan Repayment Interest Rate:</strong>
<ul>
<li>Recall the loan repayment problem where <span class="math inline">\(f(r) = \frac{A}{P} - \frac{r(1+r)^N}{(1+r)^N - 1} = 0\)</span>.</li>
<li>Given a loan amount <span class="math inline">\(P=200000\)</span>, <span class="math inline">\(N=240\)</span> months (20 years), and a monthly repayment <span class="math inline">\(A=1500\)</span>.</li>
<li><ol type="a">
<li>Write an R function for <span class="math inline">\(f(r)\)</span> based on these parameters.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Plot <span class="math inline">\(f(r)\)</span> for <span class="math inline">\(r \in [0.001, 0.02]\)</span> to visually inspect for a root.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Implement the Bisection method to find the monthly interest rate <span class="math inline">\(r\)</span>. Use an initial interval <span class="math inline">\([0.001, 0.01]\)</span> and a tolerance of <span class="math inline">\(10^{-7}\)</span>. Print the root and the number of iterations.</li>
</ol></li>
<li><ol start="4" type="a">
<li>(Optional) If you have the <code>numDeriv</code> package, calculate the derivative <span class="math inline">\(f'(r)\)</span> numerically.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fRepayment</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">r</span>, <span class="va">A</span>, <span class="va">P</span>, <span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">A</span><span class="op">/</span><span class="va">P</span> <span class="op">-</span> <span class="op">(</span><span class="va">r</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">r</span><span class="op">)</span><span class="op">^</span><span class="va">N</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">r</span><span class="op">)</span><span class="op">^</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.02</span>, by <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vX</span>, <span class="fu">fRepayment</span><span class="op">(</span><span class="va">vX</span>, <span class="fl">1500</span>, <span class="fl">200000</span>, <span class="fl">240</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bisection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">dX.l</span>, <span class="va">dX.r</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">10e-7</span>, <span class="va">max.iter</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#check inputs</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">dX.l</span> <span class="op">&gt;=</span> <span class="va">dX.r</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"error: x.l &gt;= x.r \n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.l</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.r</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">f.l</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dX.l</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">f.r</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dX.r</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">f.l</span><span class="op">*</span><span class="va">f.r</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"error: f(x.l)*f(x.r) &gt; 0 \n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># successively refine x.l and x.r</span></span>
<span>  <span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="va">dX.r</span> <span class="op">-</span> <span class="va">dX.l</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="va">iter</span> <span class="op">&lt;</span> <span class="va">max.iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dX.m</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">dX.l</span> <span class="op">+</span> <span class="va">dX.r</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="va">f.m</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.m</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">f.m</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dX.m</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">f.l</span><span class="op">*</span><span class="va">f.m</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">dX.r</span> <span class="op">&lt;-</span> <span class="va">dX.m</span></span>
<span>      <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="va">f.m</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">dX.l</span> <span class="op">&lt;-</span> <span class="va">dX.m</span></span>
<span>      <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="va">f.m</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">iter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"at iteration"</span>, <span class="va">iter</span>, <span class="st">"the root lies between"</span>, <span class="va">dX.l</span>, <span class="st">"and"</span>, <span class="va">dX.r</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="co"># return approximate root</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">(</span><span class="va">dX.l</span> <span class="op">+</span> <span class="va">dX.r</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">bisection</span><span class="op">(</span><span class="va">fRepayment</span>, dX.l <span class="op">=</span> <span class="fl">0.001</span> , dX.r <span class="op">=</span> <span class="fl">0.01</span>, dTol <span class="op">=</span> <span class="fl">10e-7</span>, A <span class="op">=</span> <span class="fl">1500</span>, P <span class="op">=</span> <span class="fl">200000</span>, N <span class="op">=</span> <span class="fl">240</span><span class="op">)</span></span>
<span><span class="co">#&gt; at iteration 14 the root lies between 0.005479126 and 0.005479675</span></span>
<span><span class="co">#&gt; [1] 0.005479401</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-28" class="level2" data-number="32.2"><h2 data-number="32.2" class="anchored" data-anchor-id="section-28">
<span class="header-section-number">32.2</span> <strong>(2)</strong>
</h2>
<ul>
<li>
<strong>Newton-Raphson Method:</strong>
<ul>
<li>Consider the function <span class="math inline">\(f(x) = x^3 - 2x - 5\)</span>.</li>
<li><ol type="a">
<li>Analytically find the first derivative <span class="math inline">\(f'(x)\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Implement the Newton-Raphson method in R to find a root of <span class="math inline">\(f(x)\)</span>. The function should take <span class="math inline">\(f, f'\)</span>, an initial guess <span class="math inline">\(x_0\)</span>, a tolerance, and max iterations as input.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Use your function to find a root starting with <span class="math inline">\(x_0 = 2\)</span>. Set tolerance to <span class="math inline">\(10^{-6}\)</span> and max iterations to 100.</li>
</ol></li>
<li><ol start="4" type="a">
<li>What happens if you start with <span class="math inline">\(x_0 = 0\)</span>?</li>
</ol></li>
</ul>
</li>
</ul>
<p>Analytical derivative: <span class="math inline">\(f'(x)=3x^2-2\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dOut</span> <span class="op">=</span> <span class="va">x</span><span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">5</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dOut</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">f_prime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dOut</span> <span class="op">=</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dOut</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">NR</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">f_prime</span>, <span class="va">dX0</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">max.iter</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dX</span> <span class="op">&lt;-</span> <span class="va">dX0</span></span>
<span>  <span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">fx</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="va">iter</span> <span class="op">&lt;</span> <span class="va">max.iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dX</span> <span class="op">&lt;-</span> <span class="va">dX</span> <span class="op">-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX</span>, <span class="va">...</span><span class="op">)</span><span class="op">/</span><span class="fu">f_prime</span><span class="op">(</span><span class="va">dX</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">iter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">fx</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Algorithm failed to converge\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Algorithm converged\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"At iteration "</span>, <span class="va">iter</span>, <span class="st">"value of x is: "</span>, <span class="va">dX</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">NR</span><span class="op">(</span><span class="va">f</span>, <span class="va">f_prime</span>, dTol <span class="op">=</span> <span class="fl">10e-6</span>, dX0 <span class="op">=</span> <span class="fl">2</span>, max.iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; Algorithm converged</span></span>
<span><span class="co">#&gt; At iteration  3 value of x is:  2.094551</span></span>
<span><span class="co">#&gt; [1] 2.094551</span></span>
<span><span class="fu">NR</span><span class="op">(</span><span class="va">f</span>, <span class="va">f_prime</span>, dTol <span class="op">=</span> <span class="fl">10e-6</span>, dX0 <span class="op">=</span> <span class="fl">0</span>, max.iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># Slower to converge. Could find a different root or may even diverge.</span></span>
<span><span class="co">#&gt; Algorithm converged</span></span>
<span><span class="co">#&gt; At iteration  18 value of x is:  2.094551</span></span>
<span><span class="co">#&gt; [1] 2.094551</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-29" class="level2" data-number="32.3"><h2 data-number="32.3" class="anchored" data-anchor-id="section-29">
<span class="header-section-number">32.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>
<strong>Secant Method:</strong>
<ul>
<li>Consider the same function <span class="math inline">\(f(x) = x^3 - 2x - 5\)</span>.</li>
<li><ol type="a">
<li>Implement the Secant method in R to find a root of <span class="math inline">\(f(x)\)</span>. The function should take <span class="math inline">\(f\)</span>, two initial guesses <span class="math inline">\(x_0, x_1\)</span>, a tolerance, and max iterations.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Use your function to find a root starting with <span class="math inline">\(x_0 = 2, x_1 = 2.5\)</span>. Set tolerance to <span class="math inline">\(10^{-6}\)</span> and max iterations to 100.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Compare the number of iterations taken by Newton-Raphson and Secant method for this problem.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dOut</span> <span class="op">=</span> <span class="va">x</span><span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">5</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dOut</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">fSecant</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">dX0</span>, <span class="va">dX1</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">max.iter</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">dX2</span> <span class="op">&lt;-</span> <span class="va">dX1</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">dX2</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="va">iter</span> <span class="op">&lt;</span> <span class="va">max.iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dX2</span> <span class="op">&lt;-</span> <span class="va">dX1</span> <span class="op">-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX1</span>, <span class="va">...</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">dX0</span> <span class="op">-</span> <span class="va">dX1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">dX0</span>, <span class="va">...</span><span class="op">)</span> <span class="op">-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX1</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dX0</span> <span class="op">&lt;-</span> <span class="va">dX1</span></span>
<span>    <span class="va">dX1</span> <span class="op">&lt;-</span> <span class="va">dX2</span></span>
<span>    <span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">iter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">dX2</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"At iteration "</span>, <span class="va">iter</span>, <span class="st">"value of x is: "</span>, <span class="va">dX1</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>root <span class="op">=</span> <span class="cn">NULL</span>, f.root <span class="op">=</span> <span class="cn">NULL</span>, iter <span class="op">=</span> <span class="va">iter</span>, <span class="st">"Algorithm failed to converge. Maximum iterations reached."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"At iteration "</span>, <span class="va">iter</span>, <span class="st">"value of x is: "</span>, <span class="va">dX1</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>root <span class="op">=</span> <span class="va">dX2</span>, f.root <span class="op">=</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX2</span><span class="op">)</span>, iterations <span class="op">=</span> <span class="va">iter</span>, <span class="st">"Convergence reached."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu">fSecant</span><span class="op">(</span><span class="va">f</span>, dX0 <span class="op">=</span> <span class="fl">2</span>, dX1 <span class="op">=</span> <span class="fl">2.5</span>, dTol <span class="op">=</span> <span class="fl">10e-6</span>, max.iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; At iteration  4 value of x is:  2.094551</span></span>
<span><span class="va">root</span> <span class="co"># 1 more step than Newton-Raphson</span></span>
<span><span class="co">#&gt; $root</span></span>
<span><span class="co">#&gt; [1] 2.094551</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $f.root</span></span>
<span><span class="co">#&gt; [1] -9.612876e-07</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] "Convergence reached."</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html">uniroot</a></span><span class="op">(</span><span class="va">f</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $root</span></span>
<span><span class="co">#&gt; [1] 2.094555</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $f.root</span></span>
<span><span class="co">#&gt; [1] 3.690185e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iter</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $init.it</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $estim.prec</span></span>
<span><span class="co">#&gt; [1] 6.103516e-05</span></span>
<span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vX</span>, <span class="fu">f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">root</span><span class="op">[</span><span class="st">"root"</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-30" class="level2" data-number="32.4"><h2 data-number="32.4" class="anchored" data-anchor-id="section-30">
<span class="header-section-number">32.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>
<strong>Using <code>uniroot</code>:</strong>
<ul>
<li>For the function <span class="math inline">\(f(x) = \cos(x) - x\)</span>:</li>
<li><ol type="a">
<li>Plot the function over an interval (e.g., <span class="math inline">\([- \pi, \pi]\)</span>) to identify a bracketing interval for a root.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Use the <code>uniroot</code> function to find the root within your chosen interval.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Write your own simple Bisection method function and compare its result and number of iterations to <code>uniroot</code> for the same interval and a similar tolerance.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="va">pi</span>, <span class="va">pi</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vX</span>, <span class="fu">f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html">uniroot</a></span><span class="op">(</span><span class="va">f</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $root</span></span>
<span><span class="co">#&gt; [1] 0.7390929</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $f.root</span></span>
<span><span class="co">#&gt; [1] -1.292031e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iter</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $init.it</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $estim.prec</span></span>
<span><span class="co">#&gt; [1] 6.103516e-05</span></span>
<span></span>
<span><span class="co"># See exercise just before this one</span></span>
<span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu">fSecant</span><span class="op">(</span><span class="va">f</span>, dX0 <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, dX1 <span class="op">=</span> <span class="fl">2</span>, dTol <span class="op">=</span> <span class="fl">10e-6</span>, max.iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; At iteration  5 value of x is:  0.7390831</span></span>
<span><span class="va">root</span></span>
<span><span class="co">#&gt; $root</span></span>
<span><span class="co">#&gt; [1] 0.7390831</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $f.root</span></span>
<span><span class="co">#&gt; [1] 3.363451e-06</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] "Convergence reached."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-31" class="level2" data-number="32.5"><h2 data-number="32.5" class="anchored" data-anchor-id="section-31">
<span class="header-section-number">32.5</span> <strong>(5)</strong>
</h2>
<ul>
<li>
<strong>Numerical Derivatives with <code>numDeriv</code>:</strong>
<ul>
<li>Consider the function <span class="math inline">\(g(x) = e^{\sin(x)} \cdot \ln(x^2+1)\)</span> for <span class="math inline">\(x &gt; 0\)</span>.</li>
<li><ol type="a">
<li>If the <code>numDeriv</code> package is installed, use the <code>grad</code> function to numerically compute the derivative of <span class="math inline">\(g(x)\)</span> at <span class="math inline">\(x=1\)</span>, <span class="math inline">\(x=2\)</span>, and <span class="math inline">\(x=3\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>(Challenge) Try to find the analytical derivative of <span class="math inline">\(g(x)\)</span> and compare its value at <span class="math inline">\(x=2\)</span> with the numerical estimate.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/">numDeriv</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">g</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3.188554</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">g</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3233247</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">g</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.934098</span></span>
<span></span>
<span><span class="co"># Analytically</span></span>
<span><span class="va">gGrad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">gGrad</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3233247</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-32" class="level2" data-number="32.6"><h2 data-number="32.6" class="anchored" data-anchor-id="section-32">
<span class="header-section-number">32.6</span> <strong>(6)</strong>
</h2>
<ul>
<li>
<strong>Comparing Root-Finding Methods:</strong>
<ul>
<li>Find a root for <span class="math inline">\(h(x) = x \cdot e^x - 1 = 0\)</span>.</li>
<li><ol type="a">
<li>Plot the function to find a suitable starting interval/point.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Solve using your Bisection method implementation.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Solve using your Newton-Raphson method implementation (you’ll need <span class="math inline">\(h'(x)\)</span>).</li>
</ol></li>
<li><ol start="4" type="a">
<li>Solve using your Secant method implementation.</li>
</ol></li>
<li><ol start="5" type="a">
<li>Solve using <code>uniroot</code>.</li>
</ol></li>
<li><ol start="6" type="a">
<li>Briefly compare the methods in terms of requirements (e.g., derivative, interval), convergence speed (number of iterations), and robustness for this specific problem.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vX</span>, <span class="fu">h</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">bisection</span><span class="op">(</span><span class="va">h</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; at iteration 21 the root lies between 0.5671425 and 0.5671434</span></span>
<span><span class="co">#&gt; [1] 0.567143</span></span>
<span></span>
<span><span class="va">hGrad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">NR</span><span class="op">(</span><span class="va">h</span>, <span class="va">hGrad</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Algorithm converged</span></span>
<span><span class="co">#&gt; At iteration  6 value of x is:  0.5671433</span></span>
<span><span class="co">#&gt; [1] 0.5671433</span></span>
<span><span class="fu">fSecant</span><span class="op">(</span><span class="va">h</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; At iteration  8 value of x is:  0.5671433</span></span>
<span><span class="co">#&gt; $root</span></span>
<span><span class="co">#&gt; [1] 0.5671433</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $f.root</span></span>
<span><span class="co">#&gt; [1] -3.581359e-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] "Convergence reached."</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html">uniroot</a></span><span class="op">(</span><span class="va">h</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $root</span></span>
<span><span class="co">#&gt; [1] 0.5671321</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $f.root</span></span>
<span><span class="co">#&gt; [1] -3.093327e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iter</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $init.it</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $estim.prec</span></span>
<span><span class="co">#&gt; [1] 6.103516e-05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exercise-set-5-numerical-optimization-univariate-and-multivariate" class="level1" data-number="33"><h1 data-number="33">
<span class="header-section-number">33</span> Exercise Set 5: Numerical Optimization (Univariate and Multivariate)</h1>
<section id="section-33" class="level2" data-number="33.1"><h2 data-number="33.1" class="anchored" data-anchor-id="section-33">
<span class="header-section-number">33.1</span> <strong>(1)</strong>
</h2>
<ul>
<li>
<strong>Univariate Optimization with Newton’s Method:</strong>
<ul>
<li>Consider the function <span class="math inline">\(f(x) = x^4 - 14x^3 + 60x^2 - 70x\)</span>.</li>
<li><ol type="a">
<li>Find the first <span class="math inline">\(f'(x)\)</span> and second <span class="math inline">\(f''(x)\)</span> derivatives analytically.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Implement Newton’s method for optimization to find a local minimum/maximum of <span class="math inline">\(f(x)\)</span>. Your function should search for <span class="math inline">\(x\)</span> where <span class="math inline">\(f'(x)=0\)</span>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Try to find a local extremum starting from <span class="math inline">\(x_0 = 0\)</span>. What do you find?</li>
</ol></li>
<li><ol start="4" type="a">
<li>Try to find a local extremum starting from <span class="math inline">\(x_0 = 6\)</span>. What do you find?</li>
</ol></li>
<li><ol start="5" type="a">
<li>Use <span class="math inline">\(f''(x)\)</span> to classify the extrema found.</li>
</ol></li>
</ul>
</li>
</ul>
<p>Analytical derivatives: <span class="math inline">\(f'(x)=4x^3-42x^2+120x-70\)</span> and <span class="math inline">\(f''(x)=12x^2-84x+120\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">4</span> <span class="op">-</span> <span class="fl">14</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">60</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">70</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fprime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">42</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">120</span> <span class="op">*</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">70</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fsecond</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">12</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">84</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">120</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">NM</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">f_prime</span>, <span class="va">f_sec</span>, <span class="va">dX0</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">n.max</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">dX</span> <span class="op">&lt;-</span> <span class="va">dX0</span></span>
<span>  <span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>  <span class="va">fpx</span> <span class="op">&lt;-</span> <span class="fu">f_prime</span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>  <span class="va">fsx</span> <span class="op">&lt;-</span> <span class="fu">f_sec</span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">fpx</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="va">n.max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dX</span> <span class="op">&lt;-</span> <span class="va">dX</span> <span class="op">-</span> <span class="va">fpx</span><span class="op">/</span><span class="va">fsx</span></span>
<span>    <span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>    <span class="va">fpx</span> <span class="op">&lt;-</span> <span class="fu">f_prime</span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>    <span class="va">fsx</span> <span class="op">&lt;-</span> <span class="fu">f_sec</span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="va">n.max</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">'newton failed to converge\n'</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"At iteration"</span>, <span class="va">n</span>, <span class="st">"the value of x is:"</span>, <span class="va">dX</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dX</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu">NM</span><span class="op">(</span><span class="va">f</span>, <span class="va">fprime</span>, <span class="va">fsecond</span>, dX0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; At iteration 5 the value of x is: 0.7808841</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu">NM</span><span class="op">(</span><span class="va">f</span>, <span class="va">fprime</span>, <span class="va">fsecond</span>, dX0 <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; At iteration 4 the value of x is: 3.761921</span></span>
<span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu">NM</span><span class="op">(</span><span class="va">f</span>, <span class="va">fprime</span>, <span class="va">fsecond</span>, dX0 <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; At iteration 3 the value of x is: 5.957195</span></span>
<span><span class="fu">fsecond</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="co"># local minimum</span></span>
<span><span class="co">#&gt; [1] 61.7231</span></span>
<span><span class="fu">fsecond</span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="co"># local maximum</span></span>
<span><span class="co">#&gt; [1] -26.17677</span></span>
<span><span class="fu">fsecond</span><span class="op">(</span><span class="va">x3</span><span class="op">)</span> <span class="co"># local minimum</span></span>
<span><span class="co">#&gt; [1] 45.45367</span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vX</span>, <span class="fu">f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-34" class="level2" data-number="33.2"><h2 data-number="33.2" class="anchored" data-anchor-id="section-34">
<span class="header-section-number">33.2</span> <strong>(2)</strong>
</h2>
<ul>
<li>
<strong>Golden Section Search:</strong>
<ul>
<li>Consider the function <span class="math inline">\(g(x) = -(x-2)^2 + 5 \sin(x)\)</span> on the interval <span class="math inline">\([0, 4]\)</span>.</li>
<li><ol type="a">
<li>Plot the function to visualize its behavior.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Implement the Golden Section Search algorithm to find the maximum of <span class="math inline">\(g(x)\)</span> within this interval. Set a tolerance of <span class="math inline">\(10^{-5}\)</span>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Compare your result with R’s <code>optimize</code> function (remember to set <code>maximum = TRUE</code>).</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vX</span>, <span class="fu">g</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">gsection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">dX.l</span>, <span class="va">dX.r</span>, <span class="va">dX.m</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># golden ratio plus one</span></span>
<span>  <span class="va">dGR1</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="co"># successively refine x.l, x.r, and x.m</span></span>
<span>  <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.l</span><span class="op">)</span></span>
<span>  <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.r</span><span class="op">)</span></span>
<span>  <span class="va">f.m</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.m</span><span class="op">)</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="va">dX.r</span> <span class="op">-</span> <span class="va">dX.l</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">dX.r</span> <span class="op">-</span> <span class="va">dX.m</span><span class="op">)</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">dX.m</span> <span class="op">-</span> <span class="va">dX.l</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># if the right segment is wider than the left </span></span>
<span>      <span class="va">dY</span> <span class="op">&lt;-</span> <span class="va">dX.m</span> <span class="op">+</span> <span class="op">(</span><span class="va">dX.r</span> <span class="op">-</span> <span class="va">dX.m</span><span class="op">)</span><span class="op">/</span><span class="va">dGR1</span> <span class="co"># put Y into the right segment according to the golden ratio</span></span>
<span>      <span class="va">f.y</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dY</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">f.y</span> <span class="op">&gt;=</span> <span class="va">f.m</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">dX.l</span> <span class="op">&lt;-</span> <span class="va">dX.m</span></span>
<span>        <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="va">f.m</span></span>
<span>        <span class="va">dX.m</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.m</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">dX.r</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co">#if the left segment is wider than the right</span></span>
<span>      <span class="va">dY</span> <span class="op">&lt;-</span> <span class="va">dX.m</span> <span class="op">-</span> <span class="op">(</span><span class="va">dX.m</span> <span class="op">-</span> <span class="va">dX.l</span><span class="op">)</span><span class="op">/</span><span class="va">dGR1</span> <span class="co"># put Y into the left segment according to the golden ratio</span></span>
<span>      <span class="va">f.y</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dY</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">f.y</span> <span class="op">&gt;=</span> <span class="va">f.m</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">dX.r</span> <span class="op">&lt;-</span> <span class="va">dX.m</span></span>
<span>        <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="va">f.m</span></span>
<span>        <span class="va">dX.m</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.m</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">dX.l</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dX.m</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">gsection</span><span class="op">(</span><span class="va">g</span>, dX.l <span class="op">=</span> <span class="fl">0</span>, dX.r <span class="op">=</span> <span class="fl">4</span>, dX.m <span class="op">=</span> <span class="fl">2</span>, dTol <span class="op">=</span> <span class="fl">10e-5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.693623</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">g</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, maximum <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $maximum</span></span>
<span><span class="co">#&gt; [1] 1.693664</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 4.868465</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-35" class="level2" data-number="33.3"><h2 data-number="33.3" class="anchored" data-anchor-id="section-35">
<span class="header-section-number">33.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>
<strong>Multivariate Optimization: Steepest Ascent:</strong>
<ul>
<li>Consider the function <span class="math inline">\(h(x, y) = -(x-1)^2 - 2(y-2)^2 + xy\)</span>.</li>
<li><ol type="a">
<li>Analytically compute the gradient <span class="math inline">\(\nabla h(x,y)\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Implement the Steepest Ascent method. For line search, you can use a fixed small step size initially or implement a simple line search (e.g., by testing a few step sizes or adapting the Golden Section search for the 1D problem along the gradient direction).</li>
</ol></li>
<li><ol start="3" type="a">
<li>Find the maximum starting from <span class="math inline">\((x_0, y_0) = (0,0)\)</span>. Set tolerance for gradient norm to <span class="math inline">\(10^{-4}\)</span>.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">hgrad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">h1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">h2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">4</span> <span class="op">*</span> <span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">h1</span>, <span class="va">h2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># golden section algorithm from last week</span></span>
<span><span class="va">gsection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">dX.l</span>, <span class="va">dX.r</span>, <span class="va">dX.m</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># golden ratio plus one</span></span>
<span>  <span class="va">dGR1</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="co"># successively refine x.l, x.r, and x.m</span></span>
<span>  <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.l</span><span class="op">)</span></span>
<span>  <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.r</span><span class="op">)</span></span>
<span>  <span class="va">f.m</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dX.m</span><span class="op">)</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="va">dX.r</span> <span class="op">-</span> <span class="va">dX.l</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">dX.r</span> <span class="op">-</span> <span class="va">dX.m</span><span class="op">)</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">dX.m</span> <span class="op">-</span> <span class="va">dX.l</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># if the right segment is wider than the left </span></span>
<span>      <span class="va">dY</span> <span class="op">&lt;-</span> <span class="va">dX.m</span> <span class="op">+</span> <span class="op">(</span><span class="va">dX.r</span> <span class="op">-</span> <span class="va">dX.m</span><span class="op">)</span><span class="op">/</span><span class="va">dGR1</span> <span class="co"># put Y into the right segment according to the golden ratio</span></span>
<span>      <span class="va">f.y</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dY</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">f.y</span> <span class="op">&gt;=</span> <span class="va">f.m</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">dX.l</span> <span class="op">&lt;-</span> <span class="va">dX.m</span></span>
<span>        <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="va">f.m</span></span>
<span>        <span class="va">dX.m</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.m</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">dX.r</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co">#if the left segment is wider than the right</span></span>
<span>      <span class="va">dY</span> <span class="op">&lt;-</span> <span class="va">dX.m</span> <span class="op">-</span> <span class="op">(</span><span class="va">dX.m</span> <span class="op">-</span> <span class="va">dX.l</span><span class="op">)</span><span class="op">/</span><span class="va">dGR1</span> <span class="co"># put Y into the left segment according to the golden ratio</span></span>
<span>      <span class="va">f.y</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">dY</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">f.y</span> <span class="op">&gt;=</span> <span class="va">f.m</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">dX.r</span> <span class="op">&lt;-</span> <span class="va">dX.m</span></span>
<span>        <span class="va">f.r</span> <span class="op">&lt;-</span> <span class="va">f.m</span></span>
<span>        <span class="va">dX.m</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.m</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">dX.l</span> <span class="op">&lt;-</span> <span class="va">dY</span></span>
<span>        <span class="va">f.l</span> <span class="op">&lt;-</span> <span class="va">f.y</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dX.m</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">line.search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">vX</span>, <span class="va">vG</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">dA.max</span> <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># f is a real function that takes a vector of length d</span></span>
<span>  <span class="co"># x and y are vectors of length d</span></span>
<span>  <span class="co"># line.search uses gsection to find a &gt;= 0 such that</span></span>
<span>  <span class="co"># g(a) = f(x + a*y) has a local maximum at a,</span></span>
<span>  <span class="co"># within a tolerance of tol</span></span>
<span>  <span class="co"># if no local max is found then we use 0 or a.max for a</span></span>
<span>  <span class="co"># the value returned is x + a*y</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">vG</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="co"># +0*vG</span></span>
<span>  <span class="op">}</span> <span class="co"># g(a) constant</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dA</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">vX</span> <span class="op">+</span> <span class="va">dA</span><span class="op">*</span><span class="va">vG</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># find a triple a.l &lt; a.m &lt; a.r such that</span></span>
<span>  <span class="co"># g(a.l) &lt;= g(a.m) and g(a.m) &gt;= g(a.r)</span></span>
<span>  </span>
<span>  <span class="co"># choose a.l</span></span>
<span>  <span class="va">dA.l</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">g.l</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.l</span><span class="op">)</span></span>
<span>  <span class="co"># find a.m</span></span>
<span>  <span class="va">dA.m</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">g.m</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.m</span><span class="op">)</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.l</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">dA.m</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dA.m</span> <span class="op">&lt;-</span> <span class="va">dA.m</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="va">g.m</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.m</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># if a suitable a.m was not found then use 0 for a, so just return vX as the next step</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">dA.m</span> <span class="op">&lt;=</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.l</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span>  <span class="co"># find a.r</span></span>
<span>  <span class="va">dA.r</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">dA.m</span></span>
<span>  <span class="va">g.r</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.r</span><span class="op">)</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.r</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">dA.r</span> <span class="op">&lt;</span> <span class="va">dA.max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dA.m</span> <span class="op">&lt;-</span> <span class="va">dA.r</span></span>
<span>    <span class="va">g.m</span> <span class="op">&lt;-</span> <span class="va">g.r</span></span>
<span>    <span class="va">dA.r</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">dA.m</span></span>
<span>    <span class="va">g.r</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">dA.r</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># if a suitable a.r was not found then use a.max for a</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">dA.r</span> <span class="op">&gt;=</span> <span class="va">dA.max</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">g.m</span> <span class="op">&lt;</span> <span class="va">g.r</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span> <span class="op">+</span> <span class="va">dA.max</span><span class="op">*</span><span class="va">vG</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span>  <span class="co"># apply golden-section algorithm to g to find a</span></span>
<span>  <span class="va">dA</span> <span class="op">&lt;-</span> <span class="fu">gsection</span><span class="op">(</span><span class="va">g</span>, <span class="va">dA.l</span>, <span class="va">dA.r</span>, <span class="va">dA.m</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span> <span class="op">+</span> <span class="va">dA</span><span class="op">*</span><span class="va">vG</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ascent</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">grad.f</span>, <span class="va">vX0</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">n.max</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vX.old</span> <span class="op">&lt;-</span> <span class="va">vX0</span></span>
<span>  <span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu">line.search</span><span class="op">(</span><span class="va">f</span>, <span class="va">vX0</span>, <span class="fu">grad.f</span><span class="op">(</span><span class="va">vX0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">-</span> <span class="fu">f</span><span class="op">(</span><span class="va">vX.old</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="va">n.max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vX.old</span> <span class="op">&lt;-</span> <span class="va">vX</span></span>
<span>    <span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu">line.search</span><span class="op">(</span><span class="va">f</span>, <span class="va">vX</span>, <span class="fu">grad.f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"at iteration"</span>, <span class="va">n</span>, <span class="st">"the coordinates of x are"</span>, <span class="va">vX</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">ascent</span><span class="op">(</span><span class="va">h</span>, <span class="va">hgrad</span>, vX0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; at iteration 16 the coordinates of x are 2.285706 2.57142</span></span>
<span><span class="co">#&gt; [1] 2.285706 2.571420</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-36" class="level2" data-number="33.4"><h2 data-number="33.4" class="anchored" data-anchor-id="section-36">
<span class="header-section-number">33.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>
<strong>Multivariate Optimization: Newton’s Method in Higher Dimensions:</strong>
<ul>
<li>For the same function <span class="math inline">\(h(x, y) = -(x-1)^2 - 2(y-2)^2 + xy\)</span> from Q3:</li>
<li><ol type="a">
<li>Analytically compute the Hessian matrix <span class="math inline">\(H(x,y)\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Implement Newton’s method for multivariate optimization.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Find the maximum starting from <span class="math inline">\((x_0, y_0) = (0,0)\)</span>. Set tolerance for gradient norm to <span class="math inline">\(10^{-4}\)</span>.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Compare the number of iterations with the Steepest Ascent method.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hcomb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">h</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">h1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">h2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">4</span> <span class="op">*</span> <span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">h11</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span></span>
<span>  <span class="va">h12</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">h22</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">4</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">h</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">h1</span>, <span class="va">h2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">h11</span>, <span class="va">h12</span>, <span class="va">h12</span>, <span class="va">h22</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">newton</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f3</span>, <span class="va">vX0</span>, <span class="va">dTol</span> <span class="op">=</span> <span class="fl">1e-9</span>, <span class="va">n.max</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Newton's method for optimisation, starting at x0</span></span>
<span>  <span class="co"># f3 is a function that given x returns the list</span></span>
<span>  <span class="co"># {f(x), grad f(x), Hessian f(x)}, for some f</span></span>
<span>  <span class="va">vX</span> <span class="op">&lt;-</span> <span class="va">vX0</span></span>
<span>  <span class="va">f3.x</span> <span class="op">&lt;-</span> <span class="fu">f3</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">f3.x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dTol</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="va">n.max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vX</span> <span class="op">&lt;-</span> <span class="va">vX</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">f3.x</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">f3.x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="co">#vX &lt;- vX - solve(f3.x[[3]])%*%f3.x[[2]]</span></span>
<span>    <span class="va">f3.x</span> <span class="op">&lt;-</span> <span class="fu">f3</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"At iteration"</span>, <span class="va">n</span>, <span class="st">"the coordinates of x are"</span>, <span class="va">vX</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="va">n.max</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">'newton failed to converge\n'</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vX</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu">newton</span><span class="op">(</span><span class="va">hcomb</span>, vX0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; At iteration 0 the coordinates of x are 2.285714 2.571429</span></span>
<span><span class="va">n1</span></span>
<span><span class="co">#&gt; [1] 2.285714 2.571429</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu">hcomb</span><span class="op">(</span><span class="va">n1</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">## maximum</span></span>
<span><span class="co">#&gt; eigen() decomposition</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1] -1.585786 -4.414214</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vectors</span></span>
<span><span class="co">#&gt;            [,1]       [,2]</span></span>
<span><span class="co">#&gt; [1,] -0.9238795 -0.3826834</span></span>
<span><span class="co">#&gt; [2,] -0.3826834  0.9238795</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-37" class="level2" data-number="33.5"><h2 data-number="33.5" class="anchored" data-anchor-id="section-37">
<span class="header-section-number">33.5</span> <strong>(5)</strong>
</h2>
<ul>
<li>
<strong>Using <code>optim</code> in R:</strong>
<ul>
<li>Consider the Rosenbrock function (often used for testing optimization algorithms): <span class="math inline">\(f(x,y) = (a-x)^2 + b(y-x^2)^2\)</span>. Let <span class="math inline">\(a=1\)</span> and <span class="math inline">\(b=100\)</span>. We want to find its minimum.</li>
<li><ol type="a">
<li>Write an R function for the Rosenbrock function.</li>
</ol></li>
<li>
<ol start="2" type="a">
<li>Use the <code>optim</code> function to find the minimum. Try the following methods:</li>
</ol>
<ul>
<li>“Nelder-Mead”</li>
<li>“BFGS”</li>
<li>“L-BFGS-B” (try with and without bounds, e.g., <span class="math inline">\(x \in [-2, 2], y \in [-1, 3]\)</span>)</li>
</ul>
</li>
<li>Start from an initial guess of <span class="math inline">\((-1.2, 1)\)</span>.</li>
<li><ol start="3" type="a">
<li>For the “BFGS” method, if you have the <code>numDeriv</code> package, provide the gradient numerically using <code>grad</code>. Does it converge faster or to a better point?</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/">numDeriv</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fRosenbrock</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">vX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">fRosenbrock</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 1.003505 1.006996</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">fRosenbrock</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 0.9998000 0.9996001</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">fRosenbrock</span>, method <span class="op">=</span> <span class="st">"L-BFGS-B"</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 0.9998032 0.9996078</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">fRosenbrock</span>, method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>, lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 0.9998006 0.9996012</span></span>
<span><span class="va">grad_rosen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">fRosenbrock</span>, <span class="va">par</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">fRosenbrock</span>, gr <span class="op">=</span> <span class="va">grad_rosen</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 1 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-38" class="level2" data-number="33.6"><h2 data-number="33.6" class="anchored" data-anchor-id="section-38">
<span class="header-section-number">33.6</span> <strong>(6)</strong>
</h2>
<ul>
<li>
<strong>Optimization Pitfalls:</strong>
<ul>
<li>Create a simple R function <span class="math inline">\(f(x) = \cos(2\pi x) + 0.1x^2\)</span>.</li>
<li><ol type="a">
<li>Plot this function over <span class="math inline">\(x \in [-3, 3]\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Use <code><a href="https://rdrr.io/r/stats/optimize.html">optimize()</a></code> to find the global minimum in this interval.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Now, use <code><a href="https://rdrr.io/r/stats/optimize.html">optimize()</a></code> to find a local minimum in the interval <span class="math inline">\([-0.5, 0.5]\)</span> and another in <span class="math inline">\([0.5, 1.5]\)</span>. Discuss how starting points or intervals affect finding local vs.&nbsp;global optima.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vX</span>, <span class="fu">f</span><span class="op">(</span><span class="va">vX</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">f</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $minimum</span></span>
<span><span class="co">#&gt; [1] 1.492439</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] -0.7761343</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">f</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $minimum</span></span>
<span><span class="co">#&gt; [1] -0.4974641</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] -0.975126</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">f</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $minimum</span></span>
<span><span class="co">#&gt; [1] 0.5000661</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] -0.9749933</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-39" class="level2" data-number="33.7"><h2 data-number="33.7" class="anchored" data-anchor-id="section-39">
<span class="header-section-number">33.7</span> <strong>(7)</strong>
</h2>
<ul>
<li>
<strong>Constrained Optimization via Reparameterization:</strong>
<ul>
<li>You want to maximize <span class="math inline">\(f(p) = p^2(1-p)^3\)</span> subject to <span class="math inline">\(0 &lt; p &lt; 1\)</span>.</li>
<li><ol type="a">
<li>Use the transformation <span class="math inline">\(p = \frac{e^{\tilde{p}}}{1+e^{\tilde{p}}}\)</span> to convert this into an unconstrained problem for <span class="math inline">\(\tilde{p}\)</span>. Write the new function <span class="math inline">\(g(\tilde{p}) = f(\lambda(\tilde{p}))\)</span>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Use <code>optim</code> with “BFGS” to find the maximum of <span class="math inline">\(g(\tilde{p})\)</span>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Transform the optimal <span class="math inline">\(\tilde{p}^*\)</span> back to <span class="math inline">\(p^*\)</span> and report the maximum value <span class="math inline">\(f(p^*)\)</span>.</li>
</ol></li>
<li><ol start="4" type="a">
<li>(Optional) Analytically find the maximum and compare.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_tilde</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">p_tilde</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">p_tilde</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">optim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">g</span>, method <span class="op">=</span> <span class="st">"BFGS"</span>, , control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fnscale<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_tilde</span> <span class="op">&lt;-</span> <span class="va">optim_res</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="va">p_optim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">p_tilde</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">p_tilde</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_optim</span></span>
<span><span class="co">#&gt; [1] 0.4</span></span>
<span><span class="fu">f</span><span class="op">(</span><span class="va">p_optim</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03456</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-40" class="level2" data-number="33.8"><h2 data-number="33.8" class="anchored" data-anchor-id="section-40">
<span class="header-section-number">33.8</span> <strong>(8)</strong>
</h2>
<ul>
<li>
<strong>Likelihood Maximization:</strong>
<ul>
<li>Suppose you have <span class="math inline">\(n=10\)</span> observations <span class="math inline">\(y = (1, 0, 1, 1, 0, 1, 0, 0, 1, 1)\)</span> from a Bernoulli distribution with unknown probability <span class="math inline">\(p\)</span>. The log-likelihood function is <span class="math inline">\(L(p|y) = \sum y_i \log(p) + \sum (1-y_i) \log(1-p)\)</span>.</li>
<li><ol type="a">
<li>Write an R function for the negative log-likelihood (since <code>optim</code> minimizes).</li>
</ol></li>
<li><ol start="2" type="a">
<li>Use <code>optim</code> with method “L-BFGS-B” and appropriate bounds for <span class="math inline">\(p\)</span> (e.g., <span class="math inline">\([0.001, 0.999]\)</span>) to find the Maximum Likelihood Estimate (MLE) of <span class="math inline">\(p\)</span>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Compare this to the analytical MLE, which is <span class="math inline">\(\bar{y}\)</span>.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">neg_log</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dSum1</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">dSum2</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dSum1</span> <span class="op">&lt;-</span> <span class="va">dSum1</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>    <span class="va">dSum2</span> <span class="op">&lt;-</span> <span class="va">dSum2</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dSum1</span> <span class="op">+</span> <span class="va">dSum2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">neg_log_lik_bern</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">||</span> <span class="va">p</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span> <span class="co"># Bounds for log</span></span>
<span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">data</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">vY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">neg_log</span>, y <span class="op">=</span> <span class="va">vY</span>, method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>, lower <span class="op">=</span> <span class="fl">0.001</span>, upper <span class="op">=</span> <span class="fl">0.999</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 0.5999997</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">neg_log_lik_bern</span>, data <span class="op">=</span> <span class="va">vY</span>, method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>, lower <span class="op">=</span> <span class="fl">0.001</span>, upper <span class="op">=</span> <span class="fl">0.999</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 0.5999997</span></span>
<span><span class="co"># Analytical MLE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vY</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exercise-set-6-c-with-rcpp-and-rcpparmadillo" class="level1" data-number="34"><h1 data-number="34">
<span class="header-section-number">34</span> Exercise Set 6: C++ with Rcpp and RcppArmadillo</h1>
<section id="section-41" class="level2" data-number="34.1"><h2 data-number="34.1" class="anchored" data-anchor-id="section-41">
<span class="header-section-number">34.1</span> <strong>(1)</strong>
</h2>
<ul>
<li>
<strong>Basic Rcpp Function:</strong>
<ul>
<li>Write a C++ function using <code>Rcpp</code> (via <code>cppFunction</code> or <code>sourceCpp</code>) named <code>sum_greater_than_C</code> that takes a numeric vector <code>x</code> and a scalar <code>threshold</code> as input.</li>
<li>The function should return the sum of all elements in <code>x</code> that are strictly greater than <code>threshold</code>.</li>
<li>Test your C++ function in R and compare its output with an equivalent R implementation for <code>x = rnorm(1000)</code> and <code>threshold = 0</code>.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rcpp.org">Rcpp</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: pakke 'Rcpp' blev bygget under R version 4.3.3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">double sum_greater_than_C(NumericVector x, double threshold) {</span></span>
<span><span class="st">  double total = 0;</span></span>
<span><span class="st">  for (int i = 0; i &lt; x.size(); i++) {</span></span>
<span><span class="st">    if (x[i] &gt; threshold) {</span></span>
<span><span class="st">      total += x[i];</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  return total;</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu">sum_greater_than_C</span><span class="op">(</span><span class="va">vX</span>, <span class="va">threshold</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 420.1322</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">vX</span><span class="op">[</span><span class="va">vX</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 420.1322</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-42" class="level2" data-number="34.2"><h2 data-number="34.2" class="anchored" data-anchor-id="section-42">
<span class="header-section-number">34.2</span> <strong>(2)</strong>
</h2>
<ul>
<li>
<strong>Fibonacci Sequence in C++:</strong>
<ul>
<li><ol type="a">
<li>Write a recursive C++ function <code>fib_cpp(n)</code> to compute the n-th Fibonacci number.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Write an iterative (loop-based) C++ function <code>fib_iter_cpp(n)</code> to compute the n-th Fibonacci number.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Compare the execution speed of <code>fib_cpp(25)</code>, <code>fib_iter_cpp(25)</code>, and an R recursive Fibonacci function for <span class="math inline">\(n=25\)</span> using <code>microbenchmark</code>.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rcpp.org">Rcpp</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/">microbenchmark</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">int fib_cpp(int n) {</span></span>
<span><span class="st">  if (n &lt;= 1) return(0);</span></span>
<span><span class="st">  return fib_cpp(n - 1) + fib_cpp(n - 2);</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">int fib_iter_cpp(int n) {</span></span>
<span><span class="st">  if (n &lt;= 1) return(0);</span></span>
<span><span class="st">  int a = 0, b = 1, temp;</span></span>
<span><span class="st">  for (int i = 2; i &lt;= n; i++) {</span></span>
<span><span class="st">    temp = a + b;</span></span>
<span><span class="st">    a = b;</span></span>
<span><span class="st">    b = temp;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  return b;</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fib_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">fib_r</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">fib_r</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span><span class="fu">fib_cpp</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span>, <span class="fu">fib_iter_cpp</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span>, <span class="fu">fib_r</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: nanoseconds</span></span>
<span><span class="co">#&gt;              expr      min       lq     mean   median       uq       max neval</span></span>
<span><span class="co">#&gt;       fib_cpp(25)   150000   152550   182500   162300   184400   1006200   100</span></span>
<span><span class="co">#&gt;  fib_iter_cpp(25)      700     1000    13350     2900    10400    811600   100</span></span>
<span><span class="co">#&gt;         fib_r(25) 87031600 88521350 92179973 89966200 92497400 134088200   100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-43" class="level2" data-number="34.3"><h2 data-number="34.3" class="anchored" data-anchor-id="section-43">
<span class="header-section-number">34.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>
<strong>RcppArmadillo: Matrix Operations:</strong>
<ul>
<li><ol type="a">
<li>Create an R script that defines a C++ function <code>arma_matrix_ops</code> using <code>RcppArmadillo</code>.</li>
</ol></li>
<li>This function should take two matrices, <code>mA</code> and <code>mB</code>, as input (use <code>arma::mat</code>).</li>
<li>It should return a list containing:
<ul>
<li>
<code>mProd</code>: The standard matrix product <span class="math inline">\(mA \times mB\)</span>.</li>
<li>
<code>mInvA</code>: The inverse of <code>mA</code> (if possible, handle potential errors if not invertible, e.g.&nbsp;by trying and catching or checking determinant if simple).</li>
<li>
<code>vEigenvalsA</code>: The eigenvalues of <code>mA</code> (use <code>arma::eig_sym</code> if symmetric, or <code>arma::eig_gen</code> if general; assume real eigenvalues for simplicity or return complex as string if needed).</li>
</ul>
</li>
<li><ol start="2" type="a">
<li>In R, create two 3x3 matrices, test your function, and verify the product with R’s <code>%*%</code>.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rcpp.org">Rcpp</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RcppCore/RcppArmadillo">RcppArmadillo</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: pakke 'RcppArmadillo' blev bygget under R version 4.3.3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html">sourceCpp</a></span><span class="op">(</span><span class="st">"extra_cpp.cpp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; vX &lt;- 1:10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; dS &lt;- 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; res &lt;- cpp_vector_scalar_mult(vX, dS)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; print(res)</span></span>
<span><span class="co">#&gt;       [,1]</span></span>
<span><span class="co">#&gt;  [1,]    5</span></span>
<span><span class="co">#&gt;  [2,]   10</span></span>
<span><span class="co">#&gt;  [3,]   15</span></span>
<span><span class="co">#&gt;  [4,]   20</span></span>
<span><span class="co">#&gt;  [5,]   25</span></span>
<span><span class="co">#&gt;  [6,]   30</span></span>
<span><span class="co">#&gt;  [7,]   35</span></span>
<span><span class="co">#&gt;  [8,]   40</span></span>
<span><span class="co">#&gt;  [9,]   45</span></span>
<span><span class="co">#&gt; [10,]   50</span></span>
<span></span>
<span><span class="va">mA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">mB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">arma_matrix_ops</span><span class="op">(</span><span class="va">mA</span>, <span class="va">mB</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matrix mA is singular.</span></span>
<span><span class="co">#&gt; $mProd</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]   90   54   18</span></span>
<span><span class="co">#&gt; [2,]  114   69   24</span></span>
<span><span class="co">#&gt; [3,]  138   84   30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vEigenvalsA</span></span>
<span><span class="co">#&gt;                  [,1]</span></span>
<span><span class="co">#&gt; [1,]  1.611684e+01+0i</span></span>
<span><span class="co">#&gt; [2,] -1.116844e+00+0i</span></span>
<span><span class="co">#&gt; [3,] -5.700691e-16+0i</span></span>
<span><span class="va">mA</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">mB</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]   90   54   18</span></span>
<span><span class="co">#&gt; [2,]  114   69   24</span></span>
<span><span class="co">#&gt; [3,]  138   84   30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-44" class="level2" data-number="34.4"><h2 data-number="34.4" class="anchored" data-anchor-id="section-44">
<span class="header-section-number">34.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>
<strong>Simulating GARCH(1,1) process in C++:</strong>
<ul>
<li>The GARCH(1,1) process is defined by: <span class="math inline">\(r_t = \sigma_t \epsilon_t\)</span>, where <span class="math inline">\(\epsilon_t \sim N(0,1)\)</span> <span class="math inline">\(\sigma_t^2 = \omega + \alpha r_{t-1}^2 + \beta \sigma_{t-1}^2\)</span>
</li>
<li>Write a C++ function using <code>RcppArmadillo</code> named <code>simulate_garch_cpp</code> that takes parameters <span class="math inline">\(\omega, \alpha, \beta\)</span>, number of time steps <code>T</code>, and an initial <span class="math inline">\(\sigma_0^2\)</span> as input.</li>
<li>The function should simulate and return a list containing two vectors: <code>vR</code> (the returns <span class="math inline">\(r_t\)</span>) and <code>vSigma2</code> (the variances <span class="math inline">\(\sigma_t^2\)</span>).</li>
<li>(Hint: Use <code>R::rnorm(0,1)</code> for <span class="math inline">\(\epsilon_t\)</span>. Initialize <span class="math inline">\(r_0\)</span> using <span class="math inline">\(\sigma_0\)</span>).</li>
<li>Test by simulating 1000 steps with <span class="math inline">\(\omega=0.1, \alpha=0.05, \beta=0.9, \sigma_0^2=1\)</span>. Plot the simulated returns and variances.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rcpp.org">Rcpp</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RcppCore/RcppArmadillo">RcppArmadillo</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html">sourceCpp</a></span><span class="op">(</span><span class="st">"extra_cpp.cpp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; vX &lt;- 1:10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; dS &lt;- 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; res &lt;- cpp_vector_scalar_mult(vX, dS)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; print(res)</span></span>
<span><span class="co">#&gt;       [,1]</span></span>
<span><span class="co">#&gt;  [1,]    5</span></span>
<span><span class="co">#&gt;  [2,]   10</span></span>
<span><span class="co">#&gt;  [3,]   15</span></span>
<span><span class="co">#&gt;  [4,]   20</span></span>
<span><span class="co">#&gt;  [5,]   25</span></span>
<span><span class="co">#&gt;  [6,]   30</span></span>
<span><span class="co">#&gt;  [7,]   35</span></span>
<span><span class="co">#&gt;  [8,]   40</span></span>
<span><span class="co">#&gt;  [9,]   45</span></span>
<span><span class="co">#&gt; [10,]   50</span></span>
<span></span>
<span><span class="va">iT</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">dOmega</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">dAlpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">dBeta</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span><span class="va">dSigmaInit</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span></span>
<span><span class="va">lSim</span> <span class="op">&lt;-</span> <span class="fu">simulate_garch_cpp</span><span class="op">(</span><span class="va">iT</span>, <span class="va">dOmega</span>, <span class="va">dAlpha</span>, <span class="va">dBeta</span>, <span class="va">dSigmaInit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">lSim</span><span class="op">[[</span><span class="st">"vSigma2"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">1</span>, xlab <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">lSim</span><span class="op">[[</span><span class="st">"vR"</span><span class="op">]</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-45" class="level2" data-number="34.5"><h2 data-number="34.5" class="anchored" data-anchor-id="section-45">
<span class="header-section-number">34.5</span> <strong>(5)</strong>
</h2>
<ul>
<li>
<strong>Calling R functions from C++:</strong>
<ul>
<li><ol type="a">
<li>Write a simple R function <code>my_r_summary &lt;- function(x) list(mean=mean(x), sd=sd(x))</code>.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Write a C++ function <code>call_r_from_cpp</code> that takes a <code>NumericVector x</code> and an R <code>Function r_func</code> as input.</li>
</ol></li>
<li>Inside the C++ function, call <code>r_func</code> with <code>x</code> and return the result.</li>
<li><ol start="3" type="a">
<li>Test this by calling <code>call_r_from_cpp(rnorm(100), my_r_summary)</code> from R.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_r_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">SEXP call_r_from_cpp(NumericVector x, Function r_func) {</span></span>
<span><span class="st">  return r_func(x);</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">call_r_from_cpp</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="va">my_r_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; $mean</span></span>
<span><span class="co">#&gt; [1] -0.10438</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sd</span></span>
<span><span class="co">#&gt; [1] 1.056556</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-46" class="level2" data-number="34.6"><h2 data-number="34.6" class="anchored" data-anchor-id="section-46">
<span class="header-section-number">34.6</span> <strong>(6)</strong>
</h2>
<ul>
<li>
<strong>SourceCpp and Embedded R code:</strong>
<ul>
<li>Create a <code>.cpp</code> file.</li>
<li>Inside it, define a simple C++ function <code>cpp_vector_scalar_mult</code> that takes an <code>arma::vec v</code> and a <code>double s</code> and returns their element-wise product <code>v * s</code>. Make sure to include <code>RcppArmadillo.h</code> and necessary <code>using namespace</code> directives, and the <code>[[Rcpp::export]]</code> tag.</li>
<li>In the same <code>.cpp</code> file, use the <code>/*** R ... */</code> block to write R code that:
<ul>
<li>Defines a sample vector and a scalar in R.</li>
<li>Calls your <code>cpp_vector_scalar_mult</code> function.</li>
<li>Prints the result.</li>
</ul>
</li>
<li>Use <code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html">sourceCpp()</a></code> in an R script to compile and run the C++ function and the embedded R code.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::depends(RcppArmadillo)]]</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;RcppArmadillo.h&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> arma<span class="op">;</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">//[[Rcpp::export]]</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>vec cpp_vector_scalar_mult<span class="op">(</span>vec v<span class="op">,</span> <span class="dt">double</span> s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v <span class="op">*</span> s<span class="op">;</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co">vX &lt;- 1:10</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co">dS &lt;- 5</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">res &lt;- cpp_vector_scalar_mult(vX, dS)</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co">print(res)</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exercise-set-7-creating-r-packages" class="level1" data-number="35"><h1 data-number="35">
<span class="header-section-number">35</span> Exercise Set 7: Creating R Packages</h1>
<section id="section-47" class="level2" data-number="35.1"><h2 data-number="35.1" class="anchored" data-anchor-id="section-47">
<span class="header-section-number">35.1</span> <strong>(1)</strong>
</h2>
<ul>
<li>
<strong>Simple R Package:</strong>
<ul>
<li>Create a new R package using RStudio named “MyUtils”.</li>
<li><ol type="a">
<li>Inside the <code>R/</code> directory, create an R script file (e.g., <code>arithmetic.R</code>). Add a simple R function <code>fAddTwoNumbers(a, b)</code> that returns their sum.</li>
</ol></li>
<li>
<ol start="2" type="a">
<li>Edit the <code>DESCRIPTION</code> file:</li>
</ol>
<ul>
<li>Give it a <code>Title</code>: “My First Utility Package”.</li>
<li>Set yourself as the <code>Author</code> and <code>Maintainer</code>.</li>
<li>Add a brief <code>Description</code>.</li>
</ul>
</li>
<li><ol start="3" type="a">
<li>Document your <code>fAddTwoNumbers</code> function. Create an <code>.Rd</code> file in the <code>man/</code> directory (e.g., <code>fAddTwoNumbers.Rd</code>). Include sections for <code>\name</code>, <code>\alias</code>, <code>\title</code>, <code>\description</code>, <code>\usage</code>, <code>\arguments</code>, <code>\value</code>, and a simple <code>\examples</code> block.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Install and restart your package (Ctrl+Shift+L or Build -&gt; Install and Restart).</li>
</ol></li>
<li><ol start="5" type="a">
<li>Test your function: <code>MyUtils::fAddTwoNumbers(5, 3)</code> and check its help page <code>?fAddTwoNumbers</code>.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">MyUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MyUtils/man/fAddTwoNumbers.html">fAddTwoNumbers</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-48" class="level2" data-number="35.2"><h2 data-number="35.2" class="anchored" data-anchor-id="section-48">
<span class="header-section-number">35.2</span> <strong>(2)</strong>
</h2>
<ul>
<li>
<strong>Package with C++ Function (Rcpp):</strong>
<ul>
<li>Extend the “MyUtils” package (or create a new one “MyCppUtils”).</li>
<li><ol type="a">
<li>In the <code>src/</code> directory, create a C++ file (e.g., <code>cpp_helpers.cpp</code>).</li>
</ol></li>
<li><ol start="2" type="a">
<li>In this file, write a C++ function <code>fGeometricSumCpp(a, r, n)</code> that calculates the sum of the first <code>n</code> terms of a geometric series: <span class="math inline">\(a + ar + ar^2 + ... + ar^{n-1}\)</span>. Use a loop. Ensure it’s exported to R using <code>[[Rcpp::export]]</code> and includes <code>&lt;Rcpp.h&gt;</code>.</li>
</ol></li>
<li>
<ol start="3" type="a">
<li>Modify the <code>DESCRIPTION</code> file:</li>
</ol>
<ul>
<li>Add <code>Rcpp</code> to <code>Imports</code>.</li>
<li>Add <code>Rcpp</code> to <code>LinkingTo</code>.</li>
</ul>
</li>
<li><ol start="4" type="a">
<li>Add an R wrapper function in an <code>R/</code> script (e.g., <code>wrappers.R</code>) called <code>fGeometricSum(a, r, n)</code> that simply calls your C++ function <code>fGeometricSumCpp(a, r, n)</code>.</li>
</ol></li>
<li><ol start="5" type="a">
<li>Document the R wrapper function <code>fGeometricSum</code> in the <code>man/</code> directory.</li>
</ol></li>
<li><ol start="6" type="a">
<li>Install and restart. Test <code>MyCppUtils::fGeometricSum(1, 0.5, 10)</code>.</li>
</ol></li>
</ul>
</li>
</ul></section><section id="section-49" class="level2" data-number="35.3"><h2 data-number="35.3" class="anchored" data-anchor-id="section-49">
<span class="header-section-number">35.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>
<strong>Package with RcppArmadillo Function:</strong>
<ul>
<li>Extend one of your previous packages (or create “MyArmaUtils”).</li>
<li><ol type="a">
<li>In the <code>src/</code> directory, create/modify a C++ file.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Write a C++ function <code>fSolveSystemArma(mA, vB)</code> that takes an <code>arma::mat mA</code> and <code>arma::vec vB</code> and solves the linear system <span class="math inline">\(mA \cdot x = vB\)</span> for <span class="math inline">\(x\)</span> using <code>arma::solve()</code>. Return <span class="math inline">\(x\)</span>. Export it. Make sure to include <code>&lt;RcppArmadillo.h&gt;</code> and the <code>[[Rcpp::depends(RcppArmadillo)]]</code> attribute.</li>
</ol></li>
<li>
<ol start="3" type="a">
<li>Modify <code>DESCRIPTION</code>:</li>
</ol>
<ul>
<li>Ensure <code>Rcpp</code>, <code>RcppArmadillo</code> are in <code>Imports</code>.</li>
<li>Ensure <code>Rcpp</code>, <code>RcppArmadillo</code> are in <code>LinkingTo</code>.</li>
</ul>
</li>
<li><ol start="4" type="a">
<li>Write an R wrapper for <code>fSolveSystemArma</code>.</li>
</ol></li>
<li><ol start="5" type="a">
<li>Document the R wrapper.</li>
</ol></li>
<li><ol start="6" type="a">
<li>Install, restart, and test with a sample 3x3 matrix and vector.</li>
</ol></li>
</ul>
</li>
</ul></section><section id="section-50" class="level2" data-number="35.4"><h2 data-number="35.4" class="anchored" data-anchor-id="section-50">
<span class="header-section-number">35.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>
<strong>Package Structure and NAMESPACE:</strong>
<ul>
<li><ol type="a">
<li>For any of the packages you’ve started, after installing and restarting (which RStudio often handles via <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code>), inspect the <code>NAMESPACE</code> file that RStudio/<code>roxygen2</code> (if used) might generate.</li>
</ol></li>
<li><ol start="2" type="a">
<li>What is the purpose of the <code>NAMESPACE</code> file in an R package?</li>
</ol></li>
<li><ol start="3" type="a">
<li>If you were not using <code>roxygen2</code> (which RStudio uses by default for new packages), how would you manually ensure your R functions and C++ functions (via their R wrappers) are exported for users of your package? (Hint: <code>export()</code> in <code>NAMESPACE</code>).</li>
</ol></li>
</ul>
</li>
</ul></section><section id="section-51" class="level2" data-number="35.5"><h2 data-number="35.5" class="anchored" data-anchor-id="section-51">
<span class="header-section-number">35.5</span> <strong>(5)</strong>
</h2>
<ul>
<li>
<strong>Building and Sharing (Conceptual):</strong>
<ul>
<li><ol type="a">
<li>For your “MyUtils” package, use RStudio’s “Build” pane to “Build Source Package”. What is the file extension of the output?</li>
</ol></li>
<li><ol start="2" type="a">
<li>If you wanted to share this package with someone who also has R development tools, which file would you send them?</li>
</ol></li>
<li><ol start="3" type="a">
<li>If you wanted to submit this package to CRAN (hypothetically), what are some of the key checks and requirements CRAN would have? (Refer to lecture notes/Hadley Wickham’s book concepts).</li>
</ol></li>
</ul>
</li>
</ul></section></section><section id="exercise-set-8-parallel-computing" class="level1" data-number="36"><h1 data-number="36">
<span class="header-section-number">36</span> Exercise Set 8: Parallel Computing</h1>
<section id="section-52" class="level2" data-number="36.1"><h2 data-number="36.1" class="anchored" data-anchor-id="section-52">
<span class="header-section-number">36.1</span> <strong>(1)</strong>
</h2>
<ul>
<li>
<strong>Basic Parallel <code>lapply</code>:</strong>
<ul>
<li><ol type="a">
<li>Create a list of 10 numeric vectors, each containing 1,000,000 random numbers from a <span class="math inline">\(N(0,1)\)</span> distribution.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Write a function <code>fSlowFunction(v)</code> that calculates <code>mean(log(abs(v) + 1))</code> and then pauses for 0.1 seconds using <code>Sys.sleep(0.1)</code>.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Use the standard <code>lapply</code> to apply <code>fSlowFunction</code> to your list of vectors. Time this operation using <code><a href="https://rdrr.io/r/base/system.time.html">system.time()</a></code>.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Now, use the <code>parallel</code> package. Detect the number of cores on your machine. Create a cluster using <code>max(1, detectCores() - 1)</code> cores.</li>
</ol></li>
<li><ol start="5" type="a">
<li>Use <code>parLapply</code> from the <code>parallel</code> package to apply <code>fSlowFunction</code> to your list. Time this operation. Remember to export necessary objects/functions to the cluster if they are not in the base environment or loaded packages on workers.</li>
</ol></li>
<li><ol start="6" type="a">
<li>Compare the execution times. Stop the cluster.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">listV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  v1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v7 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v8 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v9 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  v10 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fSlowFunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">listV</span>, <span class="va">fSlowFunction</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bruger   system forløbet </span></span>
<span><span class="co">#&gt;     0.32     0.00     1.42</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html">parLapply</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="va">listV</span>, <span class="va">fSlowFunction</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bruger   system forløbet </span></span>
<span><span class="co">#&gt;     0.07     0.02     0.39</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-53" class="level2" data-number="36.2"><h2 data-number="36.2" class="anchored" data-anchor-id="section-53">
<span class="header-section-number">36.2</span> <strong>(2)</strong>
</h2>
<ul>
<li>
<strong>Parallel Simulation and Aggregation:</strong>
<ul>
<li>You want to run 1000 simulations. In each simulation, you:
<ol type="1">
<li>Generate 500 random numbers from an Exponential distribution with rate = 0.5.</li>
<li>Calculate the mean of these 500 numbers.</li>
</ol>
</li>
<li><ol type="a">
<li>Write an R function <code>fOneSim()</code> that performs one such simulation and returns the mean.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Use <code>lapply</code> or a <code>for</code> loop to run 1000 simulations and collect the means. Time it.</li>
</ol></li>
<li><ol start="3" type="a">
<li>Use <code>parLapply</code> (or <code>mclapply</code> on non-Windows) to run these 1000 simulations in parallel. Time it and compare.</li>
</ol></li>
<li><ol start="4" type="a">
<li>Plot a histogram of the 1000 means. What does the Central Limit Theorem suggest about the shape of this distribution?</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Exponential.Simulate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span>, <span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10086</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">Exponential.Simulate</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="va">lResult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">Exponential.Simulate</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bruger   system forløbet </span></span>
<span><span class="co">#&gt;     0.02     0.00     0.02</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html">clusterExport</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="st">"Exponential.Simulate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="va">means_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html">parLapply</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">Exponential.Simulate</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bruger   system forløbet </span></span>
<span><span class="co">#&gt;     0.00     0.00     0.01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CLT suggests distribution of sample means will be approximately normal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">means_par</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="extra_exercises_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-54" class="level2" data-number="36.3"><h2 data-number="36.3" class="anchored" data-anchor-id="section-54">
<span class="header-section-number">36.3</span> <strong>(3)</strong>
</h2>
<ul>
<li>
<strong><code>parSapply</code> vs <code>sapply</code>:</strong>
<ul>
<li>Consider the task of calculating <code>sqrt(i)</code> for <code>i</code> from 1 to 1,000,000, but make each calculation artificially slow by adding <code>Sys.sleep(0.00001)</code>.</li>
<li><ol type="a">
<li>Implement this using <code>sapply</code>. Time it.</li>
</ol></li>
<li><ol start="2" type="a">
<li>Implement this using <code>parSapply</code>. Time it and compare. Remember cluster setup and shutdown.</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.00001</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bruger   system forløbet </span></span>
<span><span class="co">#&gt;     0.80     0.01     0.84</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html">parLapply</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.00001</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bruger   system forløbet </span></span>
<span><span class="co">#&gt;     0.08     0.00     0.58</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="section-55" class="level2" data-number="36.4"><h2 data-number="36.4" class="anchored" data-anchor-id="section-55">
<span class="header-section-number">36.4</span> <strong>(4)</strong>
</h2>
<ul>
<li>
<strong>Considerations for Parallelization:</strong>
<ul>
<li><ol type="a">
<li>When is parallelization most beneficial? (Think about task granularity and communication overhead).</li>
</ol></li>
<li><ol start="2" type="a">
<li>Give an example of a task that is “embarrassingly parallel” and one that is difficult or impossible to parallelize effectively.</li>
</ol></li>
<li><ol start="3" type="a">
<li>What are some potential pitfalls or complexities when writing parallel code (e.g., random number generation in parallel, race conditions - though less of an issue with <code>parLapply</code>’s model)?</li>
</ol></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># A: Task granularity high, communication overhead low.</span></span>
<span><span class="co"># B: Embarassingly paralllel: Monte Carlo sims.</span></span>
<span><span class="co">#    Difficult: Highly sequential algorithms like some recursive functions.</span></span>
<span><span class="co"># C) RNG state per worker, data transfer, debugging</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./exam2024retake.html" class="pagination-link" aria-label="Retake exam 2024">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Retake exam 2024</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./advanced_exercises.html" class="pagination-link" aria-label="Advanced exercises">
        <span class="nav-page-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Advanced exercises</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>